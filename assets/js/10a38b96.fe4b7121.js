"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[4511],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},l=Object.keys(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,g=u["".concat(s,".").concat(m)]||u[m]||c[m]||l;return n?o.createElement(g,i(i({ref:t},d),{},{components:n})):o.createElement(g,i({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,i=new Array(l);i[0]=u;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:a,i[1]=r;for(var p=2;p<l;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},47238:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return p},default:function(){return g},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return u}});var o=n(87462),a=n(63366),l=(n(67294),n(3905)),i=n(44996),r=["components"],s={id:"install-gcp",title:"Deploy Polygon nodes on Google Cloud",sidebar_label:"Google Cloud Deployment",description:"Simple deployment of your Polygon nodes on Google Cloud",keywords:["docs","polygon","deploy","nodes","gcp","google cloud"],slug:"install-gcp",image:"https://wiki.polygon.technology/img/polygon-logo.png"},p="Deploy Polygon Nodes on Google Cloud",d={unversionedId:"integrate/install-gcp",id:"integrate/install-gcp",title:"Deploy Polygon nodes on Google Cloud",description:"Simple deployment of your Polygon nodes on Google Cloud",source:"@site/docs/integrate/install-gcp.md",sourceDirName:"integrate",slug:"/integrate/install-gcp",permalink:"/matic-docs/docs/integrate/install-gcp",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/integrate/install-gcp.md",tags:[],version:"current",lastUpdatedBy:"Kennedy Batista",lastUpdatedAt:1686621530,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"install-gcp",title:"Deploy Polygon nodes on Google Cloud",sidebar_label:"Google Cloud Deployment",description:"Simple deployment of your Polygon nodes on Google Cloud",keywords:["docs","polygon","deploy","nodes","gcp","google cloud"],slug:"install-gcp",image:"https://wiki.polygon.technology/img/polygon-logo.png"},sidebar:"integrate",previous:{title:"Advanced",permalink:"/matic-docs/docs/category/advanced"}},c={},u=[{value:"Hardware requirements",id:"hardware-requirements",level:3},{value:"Software requirements",id:"software-requirements",level:3},{value:"Deploy instance (2 ways)",id:"deploy-instance-2-ways",level:2},{value:"Login to instance (optional)",id:"login-to-instance-optional",level:2}],m={toc:u};function g(e){var t=e.components,n=(0,a.Z)(e,r);return(0,l.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"deploy-polygon-nodes-on-google-cloud"},"Deploy Polygon Nodes on Google Cloud"),(0,l.kt)("p",null,"In this document, we will describe how to deploy Polygon nodes into a VM instance on Google Cloud."),(0,l.kt)("h3",{id:"hardware-requirements"},"Hardware requirements"),(0,l.kt)("p",null,"Check the minimum and recommended ",(0,l.kt)("a",{parentName:"p",href:"/docs/maintain/validate/validator-node-system-requirements"},"hardware requirements")," in Polygon Wiki."),(0,l.kt)("h3",{id:"software-requirements"},"Software requirements"),(0,l.kt)("p",null,"Use any modern Debian or Ubuntu Linux OS with long-term support, i.e. Debian 11, Ubuntu 20.04. We'll focus on Ubuntu 20.04 in this manual"),(0,l.kt)("h2",{id:"deploy-instance-2-ways"},"Deploy instance (2 ways)"),(0,l.kt)("p",null,"You may use at least two ways to create an instance in Google Cloud:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"gcloud cli, local or ",(0,l.kt)("a",{parentName:"li",href:"https://cloud.google.com/shell"},"Cloud Shell")),(0,l.kt)("li",{parentName:"ul"},"Web console")),(0,l.kt)("p",null,"We'll cover the first case in this manual. Let's start with deployment using CLI:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Follow ",(0,l.kt)("a",{parentName:"p",href:"https://cloud.google.com/compute/docs/instances/create-start-instance#before-you-begin"},'"Before you begin" section')," to install and configure gcloud command-line tool.\nPay attention to default region and zone, choose ones closer to you or your customers. You may use ",(0,l.kt)("a",{parentName:"p",href:"https://gcping.com"},"gcping.com")," to measure latency to choose the closest location.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Adjust the following command variables using your favorite editor prior executing, when required"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"POLYGON_NETWORK")," - choose ",(0,l.kt)("inlineCode",{parentName:"li"},"mainnet")," or ",(0,l.kt)("inlineCode",{parentName:"li"},"mumbai")," testnet network to run"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"POLYGON_NODETYPE")," - choose ",(0,l.kt)("inlineCode",{parentName:"li"},"archive"),",",(0,l.kt)("inlineCode",{parentName:"li"},"fullnode")," node type to run"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"POLYGON_BOOTSTRAP_MODE")," - choose bootstrap mode ",(0,l.kt)("inlineCode",{parentName:"li"},"snapshot")," or ",(0,l.kt)("inlineCode",{parentName:"li"},"from_scratch")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"POLYGON_RPC_PORT")," - choose JSON RPC bor node port to listen on, the default value is what used on VM instance creation and in firewall rules"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"EXTRA_VAR")," - choose Bor and Heimdall branches, use ",(0,l.kt)("inlineCode",{parentName:"li"},"network_version=mainnet-v1")," with ",(0,l.kt)("inlineCode",{parentName:"li"},"mainnet")," network and ",(0,l.kt)("inlineCode",{parentName:"li"},"network_version=testnet-v4")," with ",(0,l.kt)("inlineCode",{parentName:"li"},"mumbai")," network"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"INSTANCE_NAME")," - the name of a VM instance with Polygon we are going to create"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"INSTANCE_TYPE")," - GCP ",(0,l.kt)("a",{parentName:"li",href:"https://cloud.google.com/compute/docs/machine-types"},"machine type"),", default value is recommended, You may change it later if required"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"BOR_EXT_DISK_SIZE")," - additional disk size in GB to use with Bor, default value with ",(0,l.kt)("inlineCode",{parentName:"li"},"fullnode")," is recommended, You may expand it later if required. You'll need 8192GB+ with ",(0,l.kt)("inlineCode",{parentName:"li"},"archive")," node though"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"HEIMDALL_EXT_DISK_SIZE")," - additional disk size in GB to use with Heimdall, default value is recommended"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"DISK_TYPE")," - GCP ",(0,l.kt)("a",{parentName:"li",href:"https://cloud.google.com/compute/docs/disks#disk-types"},"disk type"),", SSD is highly recommended. You may need to increase the total SSD GB quota in the region you are spinning up the node."))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Use the following command to create an instance with correct hardware and software requirements. In the example below we deploy Polygon ",(0,l.kt)("inlineCode",{parentName:"p"},"mainnet")," from ",(0,l.kt)("inlineCode",{parentName:"p"},"snapshot")," with ",(0,l.kt)("inlineCode",{parentName:"p"},"fullnode")," mode:"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"   export POLYGON_NETWORK=mainnet\n   export POLYGON_NODETYPE=fullnode\n   export POLYGON_BOOTSTRAP_MODE=snapshot\n   export POLYGON_RPC_PORT=8747\n   export GCP_NETWORK_TAG=polygon\n   export EXTRA_VAR=(bor_branch=v0.3.7 heimdall_branch=v0.3.3  network_version=mainnet-v1 node_type=sentry/sentry heimdall_network=${POLYGON_NETWORK})\n   gcloud compute firewall-rules create \"polygon-p2p\" --allow=tcp:26656,tcp:30303,udp:30303 --description=\"polygon p2p\" --target-tags=${GCP_NETWORK_TAG}\n   gcloud compute firewall-rules create \"polygon-rpc\" --allow=tcp:${POLYGON_RPC_PORT} --description=\"polygon rpc\" --target-tags=${GCP_NETWORK_TAG}\n   export INSTANCE_NAME=polygon-0\n   export INSTANCE_TYPE=e2-standard-8\n   export BOR_EXT_DISK_SIZE=1024\n   export HEIMDALL_EXT_DISK_SIZE=500\n   export DISK_TYPE=pd-ssd\n   gcloud compute instances create ${INSTANCE_NAME} \\\n   --image-project=ubuntu-os-cloud \\\n   --image-family=ubuntu-2004-lts \\\n   --boot-disk-size=20 \\\n   --boot-disk-type=${DISK_TYPE} \\\n   --machine-type=${INSTANCE_TYPE} \\\n   --create-disk=name=${INSTANCE_NAME}-bor,size=${BOR_EXT_DISK_SIZE},type=${DISK_TYPE},auto-delete=no \\\n   --create-disk=name=${INSTANCE_NAME}-heimdall,size=${HEIMDALL_EXT_DISK_SIZE},type=${DISK_TYPE},auto-delete=no \\\n   --tags=${GCP_NETWORK_TAG} \\\n   --metadata=user-data='\n   #cloud-config\n\n   bootcmd:\n   - screen -dmS polygon su -l -c bash -c \"curl -L https://raw.githubusercontent.com/maticnetwork/node-ansible/master/install-gcp.sh | bash -s -- -n '${POLYGON_NETWORK}' -m '${POLYGON_NODETYPE}' -s '${POLYGON_BOOTSTRAP_MODE}' -p '${POLYGON_RPC_PORT}' -e \\\"'${EXTRA_VAR}'\\\"; bash\"'\n")),(0,l.kt)("p",null,"The instance should be created during a couple of minutes"),(0,l.kt)("h2",{id:"login-to-instance-optional"},"Login to instance (optional)"),(0,l.kt)("p",null,"It will take a couple of minutes to install all the required software and a couple of hours to download a snapshot when chosen.\nYou should see working ",(0,l.kt)("inlineCode",{parentName:"p"},"bor")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"heimdalld")," processes filling up additional drives. You may run the following commands to check it.\nConnect to instance SSH service using ",(0,l.kt)("inlineCode",{parentName:"p"},"gcloud")," SSH wrapper:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'gcloud compute ssh ${INSTANCE_NAME}\n# inside the connected session\nsudo su -\n\nps uax|egrep "bor|heimdalld"\ndf -l -h\n')),(0,l.kt)("p",null,"You may use the following command to watch the installation progress, it's really handy in case of ",(0,l.kt)("inlineCode",{parentName:"p"},"snapshot")," bootstrap"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# inside the connected session\nscreen -dr\n")),(0,l.kt)("p",null,"Use ",(0,l.kt)("inlineCode",{parentName:"p"},"Control+a d")," key combination to disconnect from progress review."),(0,l.kt)("p",null,"You may use the following commands to get Bor and Heimdall logs:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# inside the connected session\njournalctl -fu bor\njournalctl -fu heimdalld\n")),(0,l.kt)("admonition",{type:"note"},(0,l.kt)("p",{parentName:"admonition"},"Blockchain data is saved onto additional drives which are kept by default on VM instance removal. You need to remove additional disks manually if you don't need this data anymore.")),(0,l.kt)("p",null,"At the end you will get an instance as shown on the diagram below:"),(0,l.kt)("img",{src:(0,i.Z)("img/mainnet/polygon-instance.svg")}),(0,l.kt)("p",null,"If you hit an issue with this manual - please feel free to open an ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/matic-docs/issues"},"issue")," or ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/matic-docs/pulls"},"create a PR")," on ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/matic-docs"},"GitHub"),"."))}g.isMDXComponent=!0}}]);