"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[87414],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),u=r,h=d["".concat(l,".").concat(u)]||d[u]||g[u]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},39462:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return g}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],s={id:"set-up-gcp-secrets-manager",title:"Set up GCP Secrets Manager",description:"Set up GCP Secrets Manager for Polygon Edge.",keywords:["docs","polygon","edge","gcp","secrets","manager"]},l=void 0,c={unversionedId:"edge/configuration/secret-managers/set-up-gcp-secrets-manager",id:"edge/configuration/secret-managers/set-up-gcp-secrets-manager",title:"Set up GCP Secrets Manager",description:"Set up GCP Secrets Manager for Polygon Edge.",source:"@site/docs/edge/configuration/secret-managers/set-up-gcp-secrets-manager.md",sourceDirName:"edge/configuration/secret-managers",slug:"/edge/configuration/secret-managers/set-up-gcp-secrets-manager",permalink:"/matic-docs/docs/edge/configuration/secret-managers/set-up-gcp-secrets-manager",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/edge/configuration/secret-managers/set-up-gcp-secrets-manager.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686625626,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"set-up-gcp-secrets-manager",title:"Set up GCP Secrets Manager",description:"Set up GCP Secrets Manager for Polygon Edge.",keywords:["docs","polygon","edge","gcp","secrets","manager"]},sidebar:"edge",previous:{title:"Set up AWS SSM (Systems Manager)",permalink:"/matic-docs/docs/edge/configuration/secret-managers/set-up-aws-ssm"},next:{title:"Set up Hashicorp Vault",permalink:"/matic-docs/docs/edge/configuration/secret-managers/set-up-hashicorp-vault"}},p={},g=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"GCP Billing Account",id:"gcp-billing-account",level:3},{value:"Secrets Manager API",id:"secrets-manager-api",level:3},{value:"GCP Credentials",id:"gcp-credentials",level:3},{value:"Step 1 - Generate the secrets manager configuration",id:"step-1---generate-the-secrets-manager-configuration",level:2},{value:"Step 2 - Initialize secret keys using the configuration",id:"step-2---initialize-secret-keys-using-the-configuration",level:2},{value:"Step 3 - Generate the genesis file",id:"step-3---generate-the-genesis-file",level:2},{value:"Step 4 - Start the Polygon Edge client",id:"step-4---start-the-polygon-edge-client",level:2}],d={toc:g};function u(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Currently, the Polygon Edge is concerned with keeping 2 major runtime secrets:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("strong",{parentName:"li"},"validator private key")," used by the node, if the node is a validator"),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("strong",{parentName:"li"},"networking private key")," used by libp2p, for participating and communicating with other peers")),(0,o.kt)("p",null,"For additional information, please read through the ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/configuration/manage-private-keys"},"Managing Private Keys Guide")),(0,o.kt)("p",null,"The modules of the Polygon Edge ",(0,o.kt)("strong",{parentName:"p"},"should not need to know how to keep secrets"),". Ultimately, a module should not care if\na secret is stored on a far-away server or locally on the node's disk."),(0,o.kt)("p",null,"Everything a module needs to know about secret-keeping is ",(0,o.kt)("strong",{parentName:"p"},"knowing to use the secret"),", ",(0,o.kt)("strong",{parentName:"p"},"knowing which secrets to get\nor save"),". The finer implementation details of these operations are delegated away to the ",(0,o.kt)("inlineCode",{parentName:"p"},"SecretsManager"),", which of course is an abstraction."),(0,o.kt)("p",null,"The node operator that's starting the Polygon Edge can now specify which secrets manager they want to use, and as soon\nas the correct secrets manager is instantiated, the modules deal with the secrets through the mentioned interface -\nwithout caring if the secrets are stored on a disk or on a server."),(0,o.kt)("p",null,"This article details the necessary steps to get the Polygon Edge up and running with ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/secret-manager"},"GCP Secret Manager"),"."),(0,o.kt)("admonition",{title:"previous guides",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"It is ",(0,o.kt)("strong",{parentName:"p"},"highly recommended")," that before going through this article, articles on ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/get-started/set-up-ibft-locally"},(0,o.kt)("strong",{parentName:"a"},"Local Setup")),"\nand ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/get-started/set-up-ibft-on-the-cloud"},(0,o.kt)("strong",{parentName:"a"},"Cloud Setup"))," are read.")),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("h3",{id:"gcp-billing-account"},"GCP Billing Account"),(0,o.kt)("p",null,"In order to utilize GCP Secrets Manager, the user has to have ",(0,o.kt)("a",{parentName:"p",href:"https://console.cloud.google.com/"},"Billing Account")," enabled on the GCP portal.\nNew Google accounts on GCP platform are provided with some funds to get started, as a king of free trial.\nMore info ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/free"},"GCP docs")),(0,o.kt)("h3",{id:"secrets-manager-api"},"Secrets Manager API"),(0,o.kt)("p",null,"The user will need to enable the GCP Secrets Manager API, before he can use it.\nThis can be done via ",(0,o.kt)("a",{parentName:"p",href:"https://console.cloud.google.com/apis/library/secretmanager.googleapis.com"},"Secrets Manager API portal"),".\nMore info: ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/secret-manager/docs/configuring-secret-manager"},"Configuring Secret Manger")),(0,o.kt)("h3",{id:"gcp-credentials"},"GCP Credentials"),(0,o.kt)("p",null,"Finally, the user needs to generate new credentials that will be used for authentication.\nThis can be done by following the instructions posted ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/secret-manager/docs/reference/libraries"},"here"),".",(0,o.kt)("br",{parentName:"p"}),"\n","The generated json file containing credentials, should be transferred to each node that needs to utilize GCP Secrets Manager."),(0,o.kt)("p",null,"Required information before continuing:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Project ID")," (the project id defined on GCP platform)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Credentials File Location")," (the path to the json file containing the credentials)")),(0,o.kt)("h2",{id:"step-1---generate-the-secrets-manager-configuration"},"Step 1 - Generate the secrets manager configuration"),(0,o.kt)("p",null,"In order for the Polygon Edge to be able to seamlessly communicate with the GCP SM, it needs to parse an already\ngenerated config file, which contains all the necessary information for secret storage on GCP SM."),(0,o.kt)("p",null,"To generate the configuration, run the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"polygon-edge secrets generate --type gcp-ssm --dir <PATH> --name <NODE_NAME> --extra project-id=<PROJECT_ID>,gcp-ssm-cred=<GCP_CREDS_FILE>\n")),(0,o.kt)("p",null,"Parameters present:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"PATH")," is the path to which the configuration file should be exported to. Default ",(0,o.kt)("inlineCode",{parentName:"li"},"./secretsManagerConfig.json")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"NODE_NAME")," is the name of the current node for which the GCP SM configuration is being set up as. It can be an arbitrary value. Default ",(0,o.kt)("inlineCode",{parentName:"li"},"polygon-edge-node")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"PROJECT_ID")," is the ID of the project the user has defined in GCP console during account setup and Secrets Manager API activation."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"GCP_CREDS_FILE")," is the path to the json file containing credentials which will allow read/write access to the Secrets Manager.")),(0,o.kt)("admonition",{title:"Node names",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Be careful when specifying node names."),(0,o.kt)("p",{parentName:"admonition"},"The Polygon Edge uses the specified node name to keep track of the secrets it generates and uses on the GCP SM.\nSpecifying an existing node name can have consequences of failing to write secret to GCP SM."),(0,o.kt)("p",{parentName:"admonition"},"Secrets are stored on the following base path: ",(0,o.kt)("inlineCode",{parentName:"p"},"projects/PROJECT_ID/NODE_NAME"))),(0,o.kt)("h2",{id:"step-2---initialize-secret-keys-using-the-configuration"},"Step 2 - Initialize secret keys using the configuration"),(0,o.kt)("p",null,"Now that the configuration file is present, we can initialize the required secret keys with the configuration\nfile set up in step 1, using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--config"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"polygon-edge secrets init --config <PATH>\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"PATH")," param is the location of the previously generated secrets manager param from step 1."),(0,o.kt)("h2",{id:"step-3---generate-the-genesis-file"},"Step 3 - Generate the genesis file"),(0,o.kt)("p",null,"The genesis file should be generated in a similar manner to the ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/get-started/set-up-ibft-locally"},(0,o.kt)("strong",{parentName:"a"},"Local Setup")),"\nand ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/get-started/set-up-ibft-on-the-cloud"},(0,o.kt)("strong",{parentName:"a"},"Cloud Setup"))," guides, with minor changes."),(0,o.kt)("p",null,"Since GCP SM is being used instead of the local file system, validator addresses should be added through the ",(0,o.kt)("inlineCode",{parentName:"p"},"--ibft-validator")," flag:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"polygon-edge genesis --ibft-validator <VALIDATOR_ADDRESS> ...\n")),(0,o.kt)("h2",{id:"step-4---start-the-polygon-edge-client"},"Step 4 - Start the Polygon Edge client"),(0,o.kt)("p",null,"Now that the keys are set up, and the genesis file is generated, the final step to this process would be starting the\nPolygon Edge with the ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," command."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," command is used in the same manner as in the previously mentioned guides, with a minor addition - the ",(0,o.kt)("inlineCode",{parentName:"p"},"--secrets-config")," flag:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"polygon-edge server --secrets-config <PATH> ...\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"PATH")," param is the location of the previously generated secrets manager param from step 1."))}u.isMDXComponent=!0}}]);