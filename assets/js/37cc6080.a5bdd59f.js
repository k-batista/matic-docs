"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[73451],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return m}});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(a),m=i,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||o;return a?n.createElement(h,r(r({ref:t},d),{},{components:a})):n.createElement(h,r({ref:t},d))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=a[p];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},44942:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var n=a(87462),i=a(63366),o=(a(67294),a(3905)),r=["components"],l={id:"dapp-fauna-polygon-react",sidebar_label:"dApps Data Tutorial",title:"Data Tutorial for Decentralized Applications",description:"Build dapps using Fauna, Polygon, and React",keywords:["docs","matic","dapp","fauna","polygon","data","security","react"],image:"https://wiki.polygon.technology/img/polygon-logo.png",slug:"dapp-fauna-polygon-react"},s=void 0,p={unversionedId:"develop/dapp-fauna-polygon-react",id:"develop/dapp-fauna-polygon-react",title:"Data Tutorial for Decentralized Applications",description:"Build dapps using Fauna, Polygon, and React",source:"@site/docs/develop/dapp-fauna-polygon-react.md",sourceDirName:"develop",slug:"/develop/dapp-fauna-polygon-react",permalink:"/matic-docs/docs/develop/dapp-fauna-polygon-react",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/develop/dapp-fauna-polygon-react.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686626387,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"dapp-fauna-polygon-react",sidebar_label:"dApps Data Tutorial",title:"Data Tutorial for Decentralized Applications",description:"Build dapps using Fauna, Polygon, and React",keywords:["docs","matic","dapp","fauna","polygon","data","security","react"],image:"https://wiki.polygon.technology/img/polygon-logo.png",slug:"dapp-fauna-polygon-react"},sidebar:"develop",previous:{title:"Covalent",permalink:"/matic-docs/docs/develop/data/covalent"},next:{title:"Identity",permalink:"/matic-docs/docs/develop/did-implementation/getting-started"}},d={},c=[{value:"Safeguarding your dApp data",id:"safeguarding-your-dapp-data",level:2},{value:"What is Fauna?",id:"what-is-fauna",level:3},{value:"Getting started",id:"getting-started",level:2},{value:"Start building",id:"start-building",level:2},{value:"Setup",id:"setup",level:3},{value:"Smart contract configuration and functionality",id:"smart-contract-configuration-and-functionality",level:3},{value:"App and functionality development",id:"app-and-functionality-development",level:3},{value:"Fauna setup and wiring",id:"fauna-setup-and-wiring",level:3},{value:"Submit form responses to Fauna",id:"submit-form-responses-to-fauna",level:3},{value:"Handling UUID collisions",id:"handling-uuid-collisions",level:3},{value:"Submit form responses to the blockchain",id:"submit-form-responses-to-the-blockchain",level:3},{value:"Read transaction data from the blockchain and lookup in Fauna",id:"read-transaction-data-from-the-blockchain-and-lookup-in-fauna",level:3},{value:"Error and success messaging",id:"error-and-success-messaging",level:3},{value:"Conclusion",id:"conclusion",level:2}],u={toc:c};function m(e){var t=e.components,l=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,n.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"dApps"),", or decentralized applications, are apps built on the blockchain structure. There are different types of blockchains that applications can be built off of - some you might\u2019ve heard of are Ethereum and Solana."),(0,o.kt)("p",null,"These primary networks are sometimes supplemented by ",(0,o.kt)("strong",{parentName:"p"},"sidechains"),", or secondary blockchains, that run parallel to the primary blockchain. Sidechains, such as Polygon, allow for tokens and other digital assets to be used between multiple blockchains, greatly expanding the capabilities of primary blockchains and allowing use cases such as reduction of transaction fees, making primary blockchains more scalable, and having more optimized transaction traffic and capacity since sidechains only periodically update their root chain, while primary blockchains update every new block."),(0,o.kt)("p",null,"The use cases for dApps are expanding by the day - due to its growing popularity, more and more apps are imagining how they can fit their application into the decentralized world. Just as with centralized apps, some of these dApps may still require the usage of private data for scenarios like authenticating identities or purchasing something that\u2019s being shipped to your physical address."),(0,o.kt)("p",null,"Having private application data transmitted and stored on a public blockchain, while necessary for dApps, can end up causing huge privacy breaches from bad actors. So how can we protect private data from making its way into the public and immutable nature of the blockchain?"),(0,o.kt)("h2",{id:"safeguarding-your-dapp-data"},"Safeguarding your dApp data"),(0,o.kt)("p",null,"In this tutorial, we\u2019ll be building a simple allowlisting app that utilizes ",(0,o.kt)("strong",{parentName:"p"},"React")," for the UI and functionality, the ",(0,o.kt)("strong",{parentName:"p"},"Polygon")," sidechain for transactions, and ",(0,o.kt)("strong",{parentName:"p"},"Fauna")," for storing private data from transactions that we may not necessarily want to surface publicly in the blockchain. ",(0,o.kt)("strong",{parentName:"p"},"Allowlisting"),", also known as ",(0,o.kt)("strong",{parentName:"p"},"whitelisting"),", is a concept that is very common in the decentralized world - when signing up for a allowlist, you typically gain access to special privileges, such as being able to be the first to purchase digital assets."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(73465).Z,width:"600",height:"338"})),(0,o.kt)("p",null,"GIF of app workflow - user fills out form, MetaMask window pops up, and then once the transaction is submitted and confirmed, it surfaces a success message."),(0,o.kt)("p",null,"The application will take in a first name, last name, and a wallet address. Typically, a lot of allowlists take in a wallet address only, but we\u2019ll be using the first and last name as a way to pass in some additional private information within the transaction. The flow of data will be as illustrated in the diagram:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(5778).Z,width:"1018",height:"210"}),"\nUser submits their first name, last name, and wallet address successfully through a form. The new database entry is submitted to Fauna that has a randomly generated UUID, first name, last name, and wallet address. Net transaction is submitted to Polygon that passes in first name, last name, and wallet address as part of the transaction details, but each property equals the UUID generated for the Fauna database."),(0,o.kt)("h3",{id:"what-is-fauna"},"What is Fauna?"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://fauna.com/"},"Fauna")," is a data API that offers a serverless database experience. With in-depth ",(0,o.kt)("a",{parentName:"p",href:"https://docs.fauna.com/"},"documentation")," and a web-native GraphQL interface, it allows developers to quickly get started with storing their application data without needing to sacrifice things such as flexibility, scale, and performance."),(0,o.kt)("p",null,"In this tutorial, we\u2019ll be using Fauna as a method of storing private transaction data we may not want to surface on the blockchain explicitly. We\u2019ll use UUIDs populated in the private transaction data to map information from a blockchain transaction to a specific entry with the actual private transaction details in the Fauna database."),(0,o.kt)("h2",{id:"getting-started"},"Getting started"),(0,o.kt)("p",null,"In order to get started with building, follow these steps:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Create a Fauna Account \u2014 you can sign up ",(0,o.kt)("a",{parentName:"p",href:"https://dashboard.fauna.com/accounts/register?utm_source=polygon.technology&utm_medium=referral&utm_campaign=docs-tutorial"},"here"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Create a MetaMask Wallet with Polygon\u2019s Test Network (Mumbai-Testnet) configured."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"First, get set up with MetaMask ",(0,o.kt)("a",{parentName:"li",href:"/matic-docs/docs/develop/metamask/hello"},"here"),". Make sure you save your Secret Recovery Phrase."),(0,o.kt)("li",{parentName:"ul"},"Then, configure the Mumbai-Testnet on your MetaMask by following the instructions ",(0,o.kt)("a",{parentName:"li",href:"/matic-docs/docs/develop/metamask/config-polygon-on-metamask"},"here"),"."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Once you have MetaMask set up and configured for the Mumbai-Testnet, you\u2019ll need some MATIC to add to your wallet"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"MATIC is the native cryptocurrency of the Polygon network and it\u2019s used to pay network fees, for staking, and also for governance to the Polygon blockchain (MATIC holders can vote on Polygon changes). In the context of this project, you will need MATIC to pay gas fees that are charged for each transaction. You can learn more about MATIC ",(0,o.kt)("a",{parentName:"p",href:"https://www.kraken.com/en-us/learn/what-is-polygon-matic"},"here"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To get started, use the ",(0,o.kt)("a",{parentName:"p",href:"https://faucet.polygon.technology/"},"MATIC faucet")," to get free MATIC sent to your wallet (note: this MATIC will only be available on the Mumbai-Testnet and is only for development purposes). Once on the webpage, make sure the following options are selected:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img",src:a(4841).Z,width:"1058",height:"1012"})),(0,o.kt)("p",{parentName:"li"},"Network: Mumbai, Select Token: MATIC Token, Wallet Address: Put your wallet address here")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To find out what your wallet address is, you can pull it from Metamask:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img",src:a(84484).Z,width:"708",height:"720"})),(0,o.kt)("p",{parentName:"li"},"Go into MetaMask from your browser. At the top under your Account Name, you\u2019ll see a long string. That\u2019s your account ID. Copy that ID by clicking on it."),(0,o.kt)("admonition",{parentName:"li",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This can take a while and you may have to try a few times before the first transaction comes through your wallet. Each successful transaction from the MATIC faucet will give you 0.5 MATIC."),(0,o.kt)("p",{parentName:"admonition"},"Since testing the application requires spending MATIC as gas fees (a fluctuating fee that you must pay to perform transactions), we recommend doing this transaction ~12 times so you have about 6 MATIC in your wallet, which should be enough for testing the app in development."),(0,o.kt)("p",{parentName:"admonition"},"To track your wallet\u2019s transactions, you can visit ",(0,o.kt)("a",{parentName:"p",href:"https://mumbai.polygonscan.com/address/"},"https://mumbai.polygonscan.com/address/"),"[wallet address]","."))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Now, install ",(0,o.kt)("a",{parentName:"p",href:"https://trufflesuite.com/"},"Truffle")," \u2014 this is a suite of tools designed for developing Ethereum applications."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"To see if you already have Truffle installed, you can run ",(0,o.kt)("inlineCode",{parentName:"li"},"truffle version")," - if you get back a response that looks like this, you already have it installed:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"$ truffle version\nTruffle v5.4.29 (core: 5.4.29)\nSolidity v0.5.16 (solc-js)\nNode v13.8.0\nWeb3.js v1.5.3\n"))),(0,o.kt)("li",{parentName:"ul"},"To install Truffle, run ",(0,o.kt)("inlineCode",{parentName:"li"},"npm -g truffle"),"."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Also, if you don\u2019t already have it, install the tool to spin up a sample React app with ",(0,o.kt)("inlineCode",{parentName:"p"},"npm i create-react-app"),". Learn more about React ",(0,o.kt)("a",{parentName:"p",href:"https://reactjs.org/"},"here"),"."))),(0,o.kt)("h2",{id:"start-building"},"Start building"),(0,o.kt)("p",null,"If you\u2019re someone that prefers walking through code independently, the GitHub repo is available ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hello-ashleyintech/polygon-fauna-app"},"here"),". To get started with the GitHub repo, download or clone it and reference the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hello-ashleyintech/polygon-fauna-app#readme"},"README")," to get set up."),(0,o.kt)("h3",{id:"setup"},"Setup"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create a new directory for your project in your location of choice - we called ours ",(0,o.kt)("inlineCode",{parentName:"p"},"polygon-fauna-app"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once the directory is created, in your command line, ",(0,o.kt)("inlineCode",{parentName:"p"},"cd")," into the folder (ex: ",(0,o.kt)("inlineCode",{parentName:"p"},"cd polygon-fauna-app"),").")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once inside the directory, it\u2019s time to set up the app. Truffle makes it easier for us to build a decentralized application with a React front-end. To set up your initial project, run ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle unbox react"),"."),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Once the command has run, if you were to run ",(0,o.kt)("inlineCode",{parentName:"li"},"ls")," in your current directory, you\u2019d notice a variety of different subdirectories that weren\u2019t there before. The most important ones we\u2019ll be focusing on are:",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"client")," - this is where your application, its primary functionality, and its front-end will live. Within client, the structure looks exactly like a regular React project."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"contracts")," - this directory is where your smart contracts will live. Smart contracts are programs that will execute specified functionality within an account on the blockchain when the functionality is called. You might notice that the files in this directory end in ",(0,o.kt)("inlineCode",{parentName:"li"},".sol")," - this is because they are built with ",(0,o.kt)("a",{parentName:"li",href:"https://docs.soliditylang.org/"},"Solidity"),", which is an object-oriented, high-level language for implementing smart contracts."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"migrations")," - within this directory, there are preconfigured scripts that will allow you to deploy the smart contracts in ",(0,o.kt)("inlineCode",{parentName:"li"},"contracts")," on the specified network, which will end up being the Mumbai-Testnet network.")))),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"  If you use an IDE to code, now would be the perfect time to open your project in the IDE! We\u2019re going to start editing some files pretty soon.")))),(0,o.kt)("h3",{id:"smart-contract-configuration-and-functionality"},"Smart contract configuration and functionality"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Currently, the project is pointed towards deploying on the Ethereum blockchain directory. We\u2019re going to need to update this to point to the Mumbai-Testnet that we want to work off of."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To do this, first we\u2019ll need to run these commands in your command line to install some necessary packages:"),(0,o.kt)("p",{parentName:"li"},"  ",(0,o.kt)("inlineCode",{parentName:"p"},"npm install @truffle/hdwallet-provider")),(0,o.kt)("p",{parentName:"li"},"  and"),(0,o.kt)("p",{parentName:"li"},"  ",(0,o.kt)("inlineCode",{parentName:"p"},"npm install dotenv"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Then, create a file called ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," in the directory you\u2019re currently in. Within ",(0,o.kt)("inlineCode",{parentName:"p"},".env"),", do the following:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Create an environment variable called ",(0,o.kt)("inlineCode",{parentName:"p"},"MNEMONIC")," and make it equal to the Secret Recovery Phrase for your MetaMask wallet - if you didn\u2019t write it down, you can follow ",(0,o.kt)("a",{parentName:"p",href:"https://metamask.zendesk.com/hc/en-us/articles/360015290032-How-to-reveal-your-Secret-Recovery-Phrase"},"this guide")," to reveal it once again.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Create an environment variable called ",(0,o.kt)("inlineCode",{parentName:"p"},"RPC_APP_ID")," and"),(0,o.kt)("p",{parentName:"li"},"Your ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," should look something like this:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"  MNEMONIC=your secret phrase should go here\n"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Finally, replace the truffle-config.js file that was generated through Truffle with the following (note: it should be in the same directory as the client, contracts, and migrations folders):"))),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const HDWalletProvider = require("@truffle/hdwallet-provider");\nconst path = require("path");\nrequire("dotenv").config(); // Load .env file\n\nmodule.exports = {\n  // See <http://truffleframework.com/docs/advanced/configuration>\n  // to customize your Truffle configuration!\n  contracts_build_directory: path.join(__dirname, "client/src/contracts"),\n  networks: {\n    develop: {\n      port: 8545,\n    },\n    matic: {\n      provider: () =>\n        new HDWalletProvider(\n          process.env.MNEMONIC,\n          `https://matic-mumbai.chainstacklabs.com`\n        ),\n      network_id: 80001,\n      confirmations: 2,\n      timeoutBlocks: 200,\n      skipDryRun: true,\n      gas: 6000000,\n      gasPrice: 10000000000,\n    },\n  },\n};\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once you\u2019ve set up your configuration, test it and make sure it points to your account."))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To test this, migrate your current smart contracts (Truffle has auto-populated some for you) by running ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle migrate --network matic"),". If it\u2019s not your first time running this ",(0,o.kt)("inlineCode",{parentName:"p"},"deploy")," command for this project, you\u2019ll want to run ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle migrate --network matic --reset")," so it runs a fresh copy of migrations and pulls the most recent code updates."),(0,o.kt)("admonition",{parentName:"li",title:"Facing Errors?",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If you run into any issues, try the following things:")))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Make sure your ",(0,o.kt)("inlineCode",{parentName:"p"},"MNEMONIC")," environment variable is defined in a ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file in your root directory.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If you are running into continuous errors and you\u2019ve checked the above, try other RPC URLs in place of the ",(0,o.kt)("a",{parentName:"p",href:"http://matic-mubai.chainstacklabs.com"},"matic-mubai.chainstacklabs.com")," URL in ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle-config.js"),". A list of additional URLs for the Mumbai-Testnet can be found on ",(0,o.kt)("a",{parentName:"p",href:"https://docs.polygon.technology/docs/operate/network/"},"this page")," under the ",(0,o.kt)("strong",{parentName:"p"},"Mumbai-Testnet")," section."),(0,o.kt)("p",{parentName:"li"},":::"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Then, test being able to connect to your new application by running the front-end. Truffle added some pre-configured logic that will allow you to test this connection. You can test it by running the following from your main directory:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"`cd client`\n`npm run start`\n")))),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"  You will only be able to start your application inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," folder.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Your browser will launch a development instance on ",(0,o.kt)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000")," that will then prompt Metamask. It may ask you to re-auth your password. Finally, MetaMask will attempt to connect your account on the testnet to your application instance, which will cost you some MATIC in gas fees. You\u2019ll see a window like this:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img",src:a(87226).Z,width:"860",height:"1084"}))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To go through with the transaction, click \u201cConfirm\u201d. The MetaMask window will disappear and you should get a small \u201cTransaction Confirmed\u201d notification in your browser. To verify that your wallet has been connected successfully, you should see this page:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("img",{alt:"img",src:a(78532).Z,width:"960",height:"482"})),(0,o.kt)("p",{parentName:"li"},"Note that the stored value at the bottom of the page in this screenshot is the value 5. The original value is set to 0 when the page is initially loaded prior to authenticating your wallet. It will update to 5 once it is successfully connected."))),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Now, we can get to work on updating your smart contract functionality.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"To do this, we\u2019re going to clean up the ",(0,o.kt)("inlineCode",{parentName:"li"},"contracts")," directory in the root project directory. You can access it in your command line by running ",(0,o.kt)("inlineCode",{parentName:"li"},"cd ../contracts")," from the ",(0,o.kt)("inlineCode",{parentName:"li"},"client")," directory."),(0,o.kt)("li",{parentName:"ul"},"We\u2019ll first delete the default ",(0,o.kt)("inlineCode",{parentName:"li"},"SimpleStorage.sol")," file in the ",(0,o.kt)("inlineCode",{parentName:"li"},"contracts")," directory."),(0,o.kt)("li",{parentName:"ul"},"Then, we\u2019ll add a new smart contract for the specific allowlisting functionality. Within ",(0,o.kt)("inlineCode",{parentName:"li"},"contracts"),", create a new file called ",(0,o.kt)("inlineCode",{parentName:"li"},"Allowlist.sol")," and paste in the following:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-solidity"},"\n  pragma solidity ^0.5.0;\n\n  contract Allowlist {\n      // all are going to be set to uuid value in smart contract, so declare as same type\n    struct allowlister {\n      string f_name;\n      string l_name;\n      string wallet_address;\n    }\n\n    allowlister[] allowlisters; // array of all allowlisters\n\n    function _createAllowlister (string memory _uuid) public {\n      allowlisters.push(allowlister({\n        f_name: _uuid,\n        l_name: _uuid,\n        wallet_address: _uuid\n      })) -1;\n    }\n  }\n\n")),(0,o.kt)("p",null,"Let\u2019s break this code down a bit:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The smart contract, ",(0,o.kt)("inlineCode",{parentName:"p"},"Allowlist"),", contained an outline of what an allowlister (someone who submits an entry to the Allowlist) will look like. We know that we\u2019ll be taking in a first name, last name, and wallet address in the form, so we created a ",(0,o.kt)("inlineCode",{parentName:"p"},"struct")," representing an allowlister with those properties. When we store the items in the contract, they\u2019ll each map to that submission\u2019s UUID, meaning that each variable type should align with whatever variable type that UUID will be."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Since the UUID will be a string that exceeds the length of other kinds of variable types in Solidity, we\u2019ll be assigning each property the type ",(0,o.kt)("inlineCode",{parentName:"li"},"string"),", which accepts longer lengths."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"We\u2019ve also initialized an array of ",(0,o.kt)("inlineCode",{parentName:"p"},"allowlisters")," that we can add to as users submit information in the form.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Finally, we\u2019ve created a function, ",(0,o.kt)("inlineCode",{parentName:"p"},"_createAllowlister"),", that will be what we call when users submit the form. The function takes in the generated ",(0,o.kt)("inlineCode",{parentName:"p"},"_uuid")," string for that entry (the underscore in the variable name is to differentiate the variable as a function parameter). Within the function, we will push a new ",(0,o.kt)("inlineCode",{parentName:"p"},"allowlister")," instance to the ",(0,o.kt)("inlineCode",{parentName:"p"},"allowlisters")," array - each property in the instance will equal the ",(0,o.kt)("inlineCode",{parentName:"p"},"_uuid")," that is passed in.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Then, go into the migrations folder in the root directory. We\u2019re going to hop into the  2_deploy_contracts.js file and update the functionality so it deploys the new contract"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'var Allowlist = artifacts.require("./Allowlist.sol");\n\nmodule.exports = function(deployer) {\n  deployer.deploy(Allowlist);\n};\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Finally, you will migrate your new contract by running ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle migrate --network matic --reset"),"."))),(0,o.kt)("h3",{id:"app-and-functionality-development"},"App and functionality development"),(0,o.kt)("p",null,"Once you\u2019ve deployed your new smart contract, let\u2019s get started on building out the application."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"We\u2019ll be using the ",(0,o.kt)("inlineCode",{parentName:"p"},"react-hook-form")," library to build a simple form experience. You\u2019ll need to install it by running ",(0,o.kt)("inlineCode",{parentName:"p"},"npm install react-hook-form"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Next, create a new directory in ",(0,o.kt)("inlineCode",{parentName:"p"},"client/src")," titled ",(0,o.kt)("inlineCode",{parentName:"p"},"components"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Within ",(0,o.kt)("inlineCode",{parentName:"p"},"components"),", create a file called ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js")," and paste in the following:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import React, { useEffect } from "react";\nimport { useForm } from "react-hook-form";\n\nexport default function AllowlistForm(props) {\n  const {\n    register,\n    handleSubmit,\n    setValue,\n    formState: { errors },\n  } = useForm();\n\n  useEffect(() => {\n    register("firstName", { required: true });\n    register("lastName", { required: true });\n    register("walletAddress", { required: true });\n  }, [register]);\n\n  async function submitForm(data) {\n    console.log(data);\n  }\n\n  return (\n    <div className="wrapper">\n      <form onSubmit={handleSubmit((data) => submitForm(data))}>\n        <div className="header">\n          <h1>Allowlist Form</h1>\n          <p>\n            Please fill out this form to get allowlisted for this exclusive\n            project.\n          </p>\n        </div>\n        <label htmlFor="firstName">First Name</label>\n        <input\n          id="firstName"\n          onChange={(e) => setValue("firstName", e.target.value)}\n        />\n        {errors.firstName && (\n          <span role="alert" className="errorField">\n            First name is required.\n          </span>\n        )}\n        <label htmlFor="lastName">Last Name</label>\n        <input\n          id="lastName"\n          onChange={(e) => setValue("lastName", e.target.value)}\n        />\n        {errors.lastName && (\n          <span role="alert" className="errorField">\n            Last name is required.\n          </span>\n        )}\n        <label htmlFor="walletAddress">Wallet Address</label>\n        <input\n          id="walletAddress"\n          onChange={(e) => setValue("walletAddress", e.target.value)}\n        />\n        {errors.walletAddress && (\n          <span role="alert" className="errorField">\n            Wallet address is required.\n          </span>\n        )}\n        <input type="submit" className="submitButton" />\n      </form>\n    </div>\n  );\n}\n')),(0,o.kt)("p",{parentName:"li"},"The above code creates a component called ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm"),"  using the ",(0,o.kt)("inlineCode",{parentName:"p"},"react-hook-form")," library installed earlier. The form allows a ",(0,o.kt)("inlineCode",{parentName:"p"},"firstName"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"lastName"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"walletAddress")," field, and also explicitly specifies what fields are required or not for error validation. The component also contains some error-handling logic for leaving required inputs blank and attempting to submit.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Next, to make the form look better, create a file called ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.css")," and add in the following CSS code:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-css"},"\nh1 {\n  border-bottom: 1px solid white;\n  color: #3d3d3d;\n  font-family: sans-serif;\n  font-size: 20px;\n  font-weight: 600;\n  line-height: 24px;\n  text-align: center;\n}\n\n.header {\n  margin-bottom: 10px;\n}\n\nform {\n  background: white;\n  border: 1px solid #dedede;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n  margin: 0 auto;\n  margin-top: 10px;\n  max-width: 500px;\n  padding: 30px 50px 0px;\n}\n\ninput {\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  box-sizing: border-box;\n  padding: 10px;\n  width: 100%;\n  margin-bottom: 10px;\n}\n\nlabel {\n  color: #3d3d3d;\n  display: block;\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: bold;\n  margin-bottom: 5px;\n  text-align: left;\n}\n\n.errorField {\n  color: red;\n  font-family: sans-serif;\n  font-size: 12px;\n  margin-bottom: 10px;\n  text-align: left;\n}\n\n.submitButton {\n  background-color: #6976d9;\n  color: white;\n  font-family: sans-serif;\n  font-size: 14px;\n  margin: 20px 0px;\n}\n")),(0,o.kt)("admonition",{parentName:"li",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"To implement the form field, button, and input styling and color scheme, as well as to help outline form functionality, you can use ",(0,o.kt)("a",{parentName:"p",href:"https://retool.com/blog/how-to-build-a-react-form-component/"},"Retool tutorial")," on ",(0,o.kt)("inlineCode",{parentName:"p"},"react-hook-form")," as a reference.")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If you receive a warning about old stylesheets, this is probably due to a legacy version of ",(0,o.kt)("inlineCode",{parentName:"p"},"create-react-app")," that Truffle is using to set up the React project. To mitigate this, you can update your ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),"'s ",(0,o.kt)("inlineCode",{parentName:"p"},"browserlist")," property so it looks like this:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'"browserslist": {\n    "production": [\n      ">0.3%",\n      "not ie 11",\n      "not dead",\n      "not op_mini all"\n    ],\n    "development": [\n      "last 1 chrome version",\n      "last 1 firefox version",\n      "last 1 safari version",\n      ">0.3%",\n      "not ie 11",\n      "not dead",\n      "not op_mini all"\n    ]\n  }\n')))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To wire up the styling with the component, add the following import statement at the top of your ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js")," component:"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},'import "./AllowlistForm.css";'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Finally, we need to actually surface the form in our demo app. We\u2019ll do this by updating the ",(0,o.kt)("inlineCode",{parentName:"p"},"App.js")," file in the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," directory. Replace the current contents of ",(0,o.kt)("inlineCode",{parentName:"p"},"App.js")," with the following:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import React, { Component } from "react";\nimport AllowlistContract from "./contracts/Allowlist.json";\nimport getWeb3 from "./getWeb3";\nimport AllowlistForm from "./components/AllowlistForm";\n\nimport "./App.css";\n\nclass App extends Component {\n  state = { storageValue: 0, web3: null, accounts: null, contract: null };\n\n  componentDidMount = async () => {\n    try {\n      // Get network provider and web3 instance.\n      const web3 = await getWeb3();\n\n      // Use web3 to get the user\'s accounts.\n      const accounts = await web3.eth.getAccounts();\n\n      // Get the contract instance.\n      const networkId = await web3.eth.net.getId();\n      const deployedNetwork = AllowlistContract.networks[networkId];\n      const instance = new web3.eth.Contract(\n        AllowlistContract.abi,\n        deployedNetwork && deployedNetwork.address\n      );\n\n      // Set web3, accounts, and contract to the state, and then proceed with an\n      // example of interacting with the contract\'s methods.\n      this.setState({ web3, accounts, contract: instance });\n    } catch (error) {\n      // Catch any errors for any of the above operations.\n      alert(\n        `Failed to load web3, accounts, or contract. Check console for details.`\n      );\n      console.error(error);\n    }\n  };\n\n  render() {\n    if (!this.state.web3) {\n      return <div>Loading Web3, accounts, and contract...</div>;\n    }\n    return (\n      <div className="App">\n        <AllowlistForm\n          contract={this.state.contract}\n          accounts={this.state.accounts}\n        />\n      </div>\n    );\n  }\n}\n\nexport default App;\n')),(0,o.kt)("p",{parentName:"li"},"You might notice that some of this ",(0,o.kt)("inlineCode",{parentName:"p"},"App.js")," logic is similar to what was originally set up by Truffle! Our new-and-improved ",(0,o.kt)("inlineCode",{parentName:"p"},"App.js")," will do the following:"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"On page load, initialize a web3 instance, any related accounts, and an instance of our ",(0,o.kt)("inlineCode",{parentName:"p"},"Allowlist")," smart contract (pulled from ",(0,o.kt)("inlineCode",{parentName:"p"},"Allowlist.json"),", an instance of our contract that is generated from the previously run ",(0,o.kt)("inlineCode",{parentName:"p"},"truffle migrate")," command). Within these initializations, we set corresponding state variables for the contract, account list, and web3 instances.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"When the page renders, if we\u2019re still fetching all of the web3 information, it\u2019ll show a ",(0,o.kt)("inlineCode",{parentName:"p"},"Loading message")," rather than the form - this is determined by checking whether the web3 state variable has been set. Once that web3 state variable has been set, we return the ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm")," component and pass in our ",(0,o.kt)("inlineCode",{parentName:"p"},"contract")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"accounts")," state variables - we\u2019ll need them within our component to write to the blockchain when we submit the form.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To get a beautiful full-page lavender background like in the demo GIF, add the following at the bottom of your ",(0,o.kt)("inlineCode",{parentName:"p"},"App.css")," file:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-css"},"html,\nbody {\n  width: 100%;\n  height: 100%;\n  background: lavender;\n}\n")))),(0,o.kt)("p",null,"When navigating to http://localhost:3000 now, your application will look like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(21664).Z,width:"2000",height:"985"})),(0,o.kt)("p",null,"At this point, you can test the functionality of your form - try to submit empty responses to see if the error messages pop up. You can also fill out each field with random strings to test successfully submitting - to determine if it was successful, check your console, and you should see your submitted form responses as they come through."),(0,o.kt)("h3",{id:"fauna-setup-and-wiring"},"Fauna setup and wiring"),(0,o.kt)("p",null,"Now that the application is set up, hop into Fauna and connect it to our application."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Log into your Fauna account. You\u2019ll be taken to the main dashboard, where you\u2019ll create a database by clicking the \u201cCreate Database\u201d button. Create a database with a name of your choice and make sure to select the \u201cClassic\u201d Region Group:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(91283).Z,width:"844",height:"842"})),(0,o.kt)("p",null,"Once you create your database, you will be taken to the overview page."),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Within your newly created database, you\u2019re going to create a ",(0,o.kt)("a",{parentName:"li",href:"https://docs.fauna.com/fauna/current/learn/understanding/collections"},"Collection"),". Collections in Fauna are equivalent to the concept of a \u201ctable\u201d in a traditional database - a dedicated place to store entries that all have the same information and fields as one another. You\u2019ll click the \u201cNew Collection\u201d button and create a Collection with a name of your choosing:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(99810).Z,width:"1136",height:"634"})),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"  Something super interesting about Fauna is that you don\u2019t actually create ",(0,o.kt)("inlineCode",{parentName:"p"},"columns"),", which, in a traditional database, are a way to structure entries that you insert in the table. The data you insert into Fauna determines the collection structure rather than the other way around.")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Once a database and a collection within it has been made, we need to generate a secret key to be able to access it in-app. To do so, go to the ",(0,o.kt)("strong",{parentName:"li"},"Security")," option in your database and click ",(0,o.kt)("strong",{parentName:"li"},"New Key"),". Create a new key with the following settings and give it a name of your choosing:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(97894).Z,width:"1540",height:"689"})),(0,o.kt)("p",null,"Click ",(0,o.kt)("strong",{parentName:"p"},"Save")," and copy the Secret that appears above the list of keys. Then, create a ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file in your project within client - this is a React-specific environment file that the frontend will read from. Add a ",(0,o.kt)("inlineCode",{parentName:"p"},"REACT_APP_FAUNADB_SECRET")," environment variable and set it equal to the Secret that you copied when generating the API key. Your ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," should look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"REACT_APP_FAUNADB_SECRET=your secret from fauna goes here\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"  For React ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," files, all custom environment variables MUST start with ",(0,o.kt)("inlineCode",{parentName:"p"},"REACT_APP_")," in order for React to recognize them.")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Now that we have a collection ready in Fauna and an API key generated from the database it lives in, we can start writing to Fauna.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"In your project directory, run ",(0,o.kt)("inlineCode",{parentName:"p"},"npm install --save faunadb")," to install ",(0,o.kt)("inlineCode",{parentName:"p"},"faunadb")," locally.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Next, in ",(0,o.kt)("inlineCode",{parentName:"p"},"client/src"),", create an ",(0,o.kt)("inlineCode",{parentName:"p"},"api")," folder.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Within the ",(0,o.kt)("inlineCode",{parentName:"p"},"api")," folder, create a file called ",(0,o.kt)("inlineCode",{parentName:"p"},"fauna.js"),", which is going to be how we talk within our application to the Fauna API. Your ",(0,o.kt)("inlineCode",{parentName:"p"},"fauna.js")," file should look like this:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'require("dotenv").config(); // Load .env file\nexport async function addDocument(uuid, firstName, lastName, walletAddress) {\n  const faunadb = require("faunadb");\n  const q = faunadb.query;\n  const client = new faunadb.Client({\n    secret: process.env.REACT_APP_FAUNADB_SECRET,\n    domain: "db.fauna.com",\n    scheme: "https",\n  });\n  var response = client.query(\n    q.Create(q.Collection("allowlist_members"), {\n      data: {\n        uuid: uuid,\n        f_name: firstName,\n        l_name: lastName,\n        wallet_address: walletAddress,\n      },\n    })\n  );\n\n  return response;\n}\n\n')))),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"fauna.js")," starts by pulling the environment variable set in the ",(0,o.kt)("inlineCode",{parentName:"p"},"client/.env"),". Then, it declares an ",(0,o.kt)("inlineCode",{parentName:"p"},"addDocument")," function that takes in a ",(0,o.kt)("inlineCode",{parentName:"p"},"uuid")," (which we will generate programmatically in a section below), and the form-inputted ",(0,o.kt)("inlineCode",{parentName:"p"},"firstName"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"lastName"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"walletAddress"),". Within the function, it initializes an instance of a Fauna API client utilizing the secret stores in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env"),", which specifically will point Fauna to the database you created."),(0,o.kt)("p",null,"Finally, the function actually queries the API client to add a new item, called a Document, to the collection you created (in this code example it is pulling from a collection called ",(0,o.kt)("inlineCode",{parentName:"p"},"allowlist_members"),"- you\u2019ll need to change this to the name you chose for your own collection)."),(0,o.kt)("p",null,"Finally, the API response is returned once the query is executed."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"faunadb")," ",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/faunadb"},"package website")," is a great resource for insight into configuring and connecting Fauna to the app!")),(0,o.kt)("h3",{id:"submit-form-responses-to-fauna"},"Submit form responses to Fauna"),(0,o.kt)("p",null,"With the Fauna API client added in and a way to add new items to our collection, let\u2019s wire it up to our form!"),(0,o.kt)("p",null,"If you recall from the user flow, we want the following things to happen when someone submits the form:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"All the information is sent to the blockchain, but the private values are replaced with generated UUIDs."),(0,o.kt)("li",{parentName:"ol"},"Those private values (first name, last name, and wallet address) are instead sent to Fauna and stored next to that UUID.")),(0,o.kt)("p",null,"Now that we have the functionality in place to send information to Fauna, let\u2019s use it to accomplish goal #2."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add the following import at the top of your ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js")," file:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'`import { *addDocument* } from "../api/fauna";`\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Then, inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"submitForm")," function in ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js"),", replace the ",(0,o.kt)("inlineCode",{parentName:"p"},"console.log")," statement with the following:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// add data to Fauna\nconst uuid = crypto.randomUUID();\nawait addDocument(uuid, data.firstName, data.lastName, data.walletAddress)\n  .then((res) => {\n    console.log(res);\n  }\n)\n")))),(0,o.kt)("p",null,"In this snippet, we are programmatically generating a UUID using the built-in ",(0,o.kt)("inlineCode",{parentName:"p"},"crypto.randomUUID()")," ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Crypto/randomUUID"},"function"),", which will generate a 36-character-long v4 UUID. Once the UUID has been generated, we call the ",(0,o.kt)("inlineCode",{parentName:"p"},"addDocument")," function we just added. Within ",(0,o.kt)("inlineCode",{parentName:"p"},"addDocument"),", we\u2019re passing information from the form submission (captured in ",(0,o.kt)("inlineCode",{parentName:"p"},"data"),", which is being initially passed into ",(0,o.kt)("inlineCode",{parentName:"p"},"submitForm")," - ",(0,o.kt)("inlineCode",{parentName:"p"},"data.firstName"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"data.lastName"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"data.walletAddress"),") as well as the generated UUID. Finally, the API response is logged to the console, which will help us determine if the API call successfully went through."),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"At this point, your form is now configured to send information to Fauna when submitting a fully filled out form. You can test this by filling out each field in the form and submitting it. It should log an object in the console with a ",(0,o.kt)("inlineCode",{parentName:"li"},"data")," property inside it that shows all the information submitted to Fauna. To confirm that it successfully submitted, you can pull up your collection in Fauna and see if the entry is there. It should look something like this:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(68420).Z,width:"1098",height:"694"})),(0,o.kt)("h3",{id:"handling-uuid-collisions"},"Handling UUID collisions"),(0,o.kt)("p",null,"Our application is now sending responses to Fauna.\xa0However, since we\u2019re using a randomly generated UUID, there is a chance that we could have duplicated UUID entries in our database. We want to make sure that before we store any information in Fauna that there are no other UUIDs that match the one we\u2019ve generated, and if there are, we\u2019ll need to generate a new one."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In order to search the data we\u2019ve been populating into our Fauna collection, we can use an ",(0,o.kt)("a",{parentName:"p",href:"https://docs.fauna.com/fauna/current/api/fql/indexes?lang=javascript"},"Index"),". Indexes in Fauna allow you to browse and easily search the data stored in your collections. To do this, you can go to your collection in Fauna and click the \u201cNew Index\u201d button.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"You will be taken to a page to create a new index - make sure the Source Collection field has correctly populated the collection you\u2019re trying to add to. Indexes are used for querying, so try to name the index something that specifically captures what it\u2019s going to do - since the index will be used to query entries by UUID, we chose ",(0,o.kt)("inlineCode",{parentName:"p"},"allowlist_members_by_uuid"),". To specify what properties you\u2019ll be querying by, add ",(0,o.kt)("inlineCode",{parentName:"p"},"data.uuid")," into the Terms field - this lets Fauna know to pull items based on the UUID. Lastly, since you do want the UUID to be unique, check the \u201cUnique\u201d option and also make sure the \u201cSerialized\u201d option also stays checked:"))),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(8797).Z,width:"1154",height:"1100"})),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once the index has been created, we can now query it from Fauna. To do this, we\u2019ll need to hop into our client/src/api/fauna.js file and add a new function, findUUID, to search by index when given a UUID passed in as a parameter:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'\nexport async function findUUID(uuid) {\n  const faunadb = require("faunadb");\n  const q = faunadb.query;\n  const client = new faunadb.Client({\n    secret: process.env.REACT_APP_FAUNADB_SECRET,\n    domain: "db.fauna.com",\n    scheme: "https",\n  });\n  client\n    .query(q.Paginate(q.Match(q.Index("allowlist_members_by_uuid"), uuid)))\n    .then((res) => {\n      if (res.data.length === 0) {\n        return false;\n      } else {\n        return true;\n      }\n    });\n}\n\n')))),(0,o.kt)("p",null,"Very similarly to the ",(0,o.kt)("inlineCode",{parentName:"p"},"addDocuments")," function, we need to do some initial setup and configurations with the Fauna client in this function. Then, we\u2019re calling a query that looks into a specific index (in this case ",(0,o.kt)("inlineCode",{parentName:"p"},"allowlist_members_by_uuid")," ) and sees if there are any matching items that have the ",(0,o.kt)("inlineCode",{parentName:"p"},"uuid")," passed in as a function argument. In the event that there are no matches, an empty array is returned, so the function then checks for an empty array and returns ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," (indicating the UUID has not been found and is therefore not taken) - otherwise, it\u2019ll return ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," (indicating the UUID has a match)."),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Now that we have a way to check for existing UUIDs, we can add this in to our ",(0,o.kt)("inlineCode",{parentName:"p"},"submitForm")," function in our ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js")," component."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"To do this, we\u2019ll add the ",(0,o.kt)("inlineCode",{parentName:"p"},"findUUID")," function in to the ",(0,o.kt)("inlineCode",{parentName:"p"},"../api/fauna")," import statement at the top of the file like so:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import { addDocument, findUUID } from "../api/fauna";\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Replace the const uuid = crypto.randomUUID(); line with the following logic:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// generate uuid\nlet uuid = "";\n// check for duplicate uuids in db\nwhile (true) {\n  const generatedUUID = crypto.randomUUID();\n  const didFindUUID = await findUUID(generatedUUID);\n  if (!didFindUUID) {\n    uuid = generatedUUID;\n    break;\n  }\n}\n')),(0,o.kt)("p",{parentName:"li"},"With the above code, we\u2019re initializing a UUID variable. Then, we\u2019re diving into an infinite loop that will run until it is manually broken out of - within the loop, a UUID is generated using ",(0,o.kt)("inlineCode",{parentName:"p"},"crypto.randomUUID()"),". The generated UUID is then passed into a call to the ",(0,o.kt)("inlineCode",{parentName:"p"},"findUUID")," function, which will return either true or false to the variable ",(0,o.kt)("inlineCode",{parentName:"p"},"didFindUUID")," once the function call is complete. If ",(0,o.kt)("inlineCode",{parentName:"p"},"didFindUUID")," returns false, meaning there are no matches in the database for this generated UUID, then the UUID variable is set to the generated UUID and the loop is broken out of. Otherwise, the entire process is repeated until a non-duplicate UUID is identified."))))),(0,o.kt)("h3",{id:"submit-form-responses-to-the-blockchain"},"Submit form responses to the blockchain"),(0,o.kt)("p",null,"The final step in our application is to write to  the blockchain using our smart contract. As we mentioned above, we want the generated UUID that we store in Fauna to replace all of the actual private data (in this case, the first name, last name, and wallet address submitted). This adds a layer of security to the private data - it\u2019s not publicly available on the blockchain, only the UUID is, and you\u2019d need access to the Fauna database to be able to see the information behind that UUID."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Since we want the form to submit to the blockchain only if the Fauna API call is successful (and only once it happens), we can nest the API call to add a new allowlister within the Fauna API call where we add a new document. We\u2019ll do this in the ",(0,o.kt)("inlineCode",{parentName:"p"},"submitForm")," function by replacing the ",(0,o.kt)("inlineCode",{parentName:"p"},"console.log(res)")," line so that it calls our ",(0,o.kt)("inlineCode",{parentName:"p"},"_createAllowlister")," method from our smart contract:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'async function submitForm(data) {\n  // generate uuid\n    let uuid = "";\n  // check for duplicate uuids in db\n  while (true) {\n    const generatedUUID = crypto.randomUUID();\n    const didFindUUID = await findUUID(generatedUUID);\n    if (!didFindUUID) {\n      uuid = generatedUUID;\n      break;\n    }\n  }\n  // add data to Fauna\n  await addDocument(uuid, data.firstName, data.lastName, data.walletAddress)\n    .then((res) => {\n      // add data to contract\n      props.contract.methods\n        ._createAllowlister(uuid)\n        .send({ from: props.accounts[0] })\n    }\n  )\n}\n')),(0,o.kt)("p",{parentName:"li"},"Since we passed the ",(0,o.kt)("inlineCode",{parentName:"p"},"Allowlist")," smart contract and all available accounts into our ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm")," component, we\u2019re able to access them to pull information from our smart contract. Since they\u2019re passed in as props, we\u2019re referencing them as ",(0,o.kt)("inlineCode",{parentName:"p"},"props.contract")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"props.accounts")," rather than ",(0,o.kt)("inlineCode",{parentName:"p"},"contract")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"accounts"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once that has been added in, you can see if your application is successfully submitting to Fauna and the blockchain by filling out the form in your application. A MetaMask window should pop up, and if you click \u201cAccept\u201d, you\u2019ll receive a notification after a few seconds that the transaction was successfully submitted. You can also check for the newly added document in your Fauna collection to make sure it\u2019s writing to both Fauna and the blockchain."))),(0,o.kt)("h3",{id:"read-transaction-data-from-the-blockchain-and-lookup-in-fauna"},"Read transaction data from the blockchain and lookup in Fauna"),(0,o.kt)("p",null,"Now that we\u2019re able to write transactions to Fauna and then the blockchain, how can we actually find the data we need from a transaction we\u2019ve submitted?"),(0,o.kt)("p",null,"Luckily, the public nature of the blockchain makes it easy to track down transactions and also find the metadata associated with a given transaction."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"We\u2019ll be using the Mumbai Polygonscan tool to find all the transactions associated with the wallet we\u2019ve used to develop the application. This tool allows you to look up any wallet on the Mumbai-Testnet by its address and see a history of all of its transactions as well as the amount of MATIC inside the wallet.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"To find your wallet, you can go to this url: ",(0,o.kt)("a",{parentName:"li",href:"https://mumbai.polygonscan.com/address/"},"https://mumbai.polygonscan.com/address/"),"[put your wallet address here]"))),(0,o.kt)("li",{parentName:"ol"},"Once you navigate to this page, you\u2019ll see a list of all of the transactions associated with your wallet. The transactions display from most to least recent.")),(0,o.kt)("p",null,"Click on a transaction to see more information by clicking on the transaction hash - this hash is uniquely generated and is what identifies your transaction."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(32902).Z,width:"1714",height:"1110"})),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"When you click on the transaction hash, you\u2019ll go to a page that lists the transaction\u2019s specific details. To grab the information you\u2019ll need, click the \u201cClick to see more\u201d option near the bottom of the displayed transaction information."),(0,o.kt)("li",{parentName:"ol"},"Within the \u201cClick to see more\u201d option, you\u2019ll see a lot more information. We\u2019re going to scroll to the \u201cInput Data\u201d section, where there will be a long hash.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(43235).Z,width:"1670",height:"1380"})),(0,o.kt)("p",null,"We can write a script to parse the transaction hash for the Input Data, so that we can turn that hash into actual data that we can pull our ",(0,o.kt)("inlineCode",{parentName:"p"},"uuid")," from to be able to query in Fauna."),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To decode this, we can use the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ConsenSys/abi-decoder"},"abi-decoder library"),". In the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," directory of your project, run the following to install the library:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"npm install abi-decoder\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Then, create a folder named ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," directory.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Within the ",(0,o.kt)("inlineCode",{parentName:"p"},"scripts")," folder, create a file called ",(0,o.kt)("inlineCode",{parentName:"p"},"decode-transaction.js")," and paste the following information in:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const abiDecoder = require(\'abi-decoder\');\n\n// pulled from Allowlist.json "abi" field\nconst testABI = [\n    {\n      "constant": false,\n      "inputs": [\n        {\n          "internalType": "string",\n          "name": "_uuid",\n          "type": "string"\n        }\n      ],\n      "name": "_createAllowlister",\n      "outputs": [],\n      "payable": false,\n      "stateMutability": "nonpayable",\n      "type": "function"\n    }\n];\nabiDecoder.addABI(testABI);\n\n// add in your input data hash as a string here\nconst testData = "";\nconst decodedData = abiDecoder.decodeMethod(testData);\nconsole.log(decodedData);\n')))),(0,o.kt)("p",null,"The above code will create an instance of the abi-decoder library so it can be used, storing it in the variable ",(0,o.kt)("inlineCode",{parentName:"p"},"abiDecoder"),". In order to read the Input Data hash, the library requires an ABI, or Application Binary Interface, to tell the decoder what information, such as functions and arguments, is in the smart contract being used for the transaction. The ABI will help inform the decoder what information can be parsed from the hash."),(0,o.kt)("p",null,"If you used the same smart contract from this tutorial in your application, then the ABI has already been populated for you in the ",(0,o.kt)("inlineCode",{parentName:"p"},"testABI")," variable. This ABI was taken from the smart contract metadata for ",(0,o.kt)("inlineCode",{parentName:"p"},"Allowlist.sol")," that was generated upon migration. The metadata can be found in ",(0,o.kt)("inlineCode",{parentName:"p"},"client/contracts/Allowlist.json"),". Within this file, there is an ",(0,o.kt)("inlineCode",{parentName:"p"},"abi")," property, representing the ",(0,o.kt)("inlineCode",{parentName:"p"},"Allowlist")," contract ABI, which is where the ",(0,o.kt)("inlineCode",{parentName:"p"},"testABI")," value was pulled from."),(0,o.kt)("p",null,"The final touch for this program to run will be to add in the input data hash for the transaction you want to decode. Copy the Input Data you found from the Mumbai Polygonscan website and set it as a string equal to ",(0,o.kt)("inlineCode",{parentName:"p"},"testData"),"."),(0,o.kt)("ol",{start:8},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once all information has been added in to the script, we can run it in the command line to see the output. Run the script from the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," folder using this command:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"    node scripts/decode-transaction.js\n")))),(0,o.kt)("p",null,"You\u2019ll receive a response back that looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n  name: '_createAllowlister',\n  params: [\n    {\n      name: '_uuid',\n      value: '2bb542ef-39b7-4991-bfa8-aac848fdce39',\n      type: 'string'\n    }\n  ]\n}\n")),(0,o.kt)("p",null,"This response indicates that the transaction was initialized by the ",(0,o.kt)("inlineCode",{parentName:"p"},"_createAllowlister")," function from the smart contract and that the ",(0,o.kt)("inlineCode",{parentName:"p"},"_uuid")," value was passed in as a parameter (as well as what that value was)."),(0,o.kt)("p",null,"Our ",(0,o.kt)("inlineCode",{parentName:"p"},"uuid")," has been successfully identified from the transaction - in this particular response, it\u2019s ",(0,o.kt)("inlineCode",{parentName:"p"},"2bb542ef-39b7-4991-bfa8-aac848fdce39"),"."),(0,o.kt)("ol",{start:9},(0,o.kt)("li",{parentName:"ol"},"Now that we have the ",(0,o.kt)("inlineCode",{parentName:"li"},"uuid"),", we can search in Fauna using it to find the data behind the transaction. To do so, navigate to your ",(0,o.kt)("a",{parentName:"li",href:"https://dashboard.fauna.com/"},"Fauna Dashboard"),", click on the Database you used for your application, and then click on \u201cIndexes\u201d in the sidebar for that database. Make sure that the index you used for the app is displaying at the top of the page - if not, then select it from the list of indexes below to ensure you\u2019re querying from the right one.")),(0,o.kt)("p",null,"Once you have the right index pulled up, paste your UUID into the field under \u201cdata.uuid\u201d and make sure the dropdown above the field says \u201cString\u201d."),(0,o.kt)("p",null,"When you click the search button, an entry should appear below the search field:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(21475).Z,width:"1750",height:"1170"})),(0,o.kt)("p",null,"Once you expand the entry, you\u2019ll see all of the original data passed in to the form for that specific transaction, such as the first name, last name, and wallet address."),(0,o.kt)("h3",{id:"error-and-success-messaging"},"Error and success messaging"),(0,o.kt)("p",null,"We\u2019ve written a React form application that stores its data directly in Fauna and then submits it as a transaction to the blockchain where its private details are stored as a UUID, which can be used to reference the record in Fauna. We also showed how to take a transaction from the blockchain, parse its input data, and use it to search up the records in Fauna."),(0,o.kt)("p",null,"However, while working through form submission and testing everything in the application, you might\u2019ve noticed it was sometimes difficult to tell when a record was successfully submitted or not. To mitigate this, we can add in some error and success messaging that will surface to indicate an errored form submission (either from a Fauna or Polygon issue) or a successful form submission. This part of the tutorial will focus on changing some API call logic in ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Error Messaging")),(0,o.kt)("p",null,"Ideally, we\u2019d want to catch when the Fauna API throws an error, and we\u2019d also want to catch when interacting with the blockchain throws an error - either of these scenarios indicates that the transaction won\u2019t go all the way through. We also want to make sure that if Fauna fails, it doesn\u2019t still try to interact with the blockchain - this could create inconsistency in the entries."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"To do this, let\u2019s add a state variable to track whether or not the form submission has failed at any point. To initialize new state variables, we\u2019ll need to start by importing the ",(0,o.kt)("inlineCode",{parentName:"li"},"useState")," hook, which can be added in where we\u2019re importing ",(0,o.kt)("inlineCode",{parentName:"li"},"React")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"useEffect"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import React, { useEffect, useState } from "react";\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once imported, we can initialize our variable. We\u2019ll call it ",(0,o.kt)("inlineCode",{parentName:"p"},"formField")," - this will be added in after the ",(0,o.kt)("inlineCode",{parentName:"p"},"useForm()")," usage at the top of the component:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const {\n    register,\n    handleSubmit,\n    setValue,\n    formState: { errors },\n} = useForm(); // this is already in the code, add the line below\nconst [formFail, setFormFail] = useState(false);\n")))),(0,o.kt)("p",null,"To initialize a new state variable, we need to declare a name (",(0,o.kt)("inlineCode",{parentName:"p"},"formFail"),") and also a function to set it (",(0,o.kt)("inlineCode",{parentName:"p"},"setFormFail"),"). We also need to set it to a default value (since ",(0,o.kt)("inlineCode",{parentName:"p"},"formFail")," will be a boolean indicating whether or not the form has failed, we can set the default value to ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),")."),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Now, we need to make sure that we add in error messaging that uses this state variable. If ",(0,o.kt)("inlineCode",{parentName:"p"},"formFail")," becomes ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),", we\u2019d want to surface the error messaging. We can add in this snippet of ",(0,o.kt)("inlineCode",{parentName:"p"},"jsx")," within the ",(0,o.kt)("inlineCode",{parentName:"p"},"wrapper")," div class in the ",(0,o.kt)("inlineCode",{parentName:"p"},"return()")," function at the bottom of the file:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'{formFail && (\n  <div className="errorMessage">\n    <p>Failed to submit allowlist entry. Please try again.</p>\n  </div>\n)}\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"In addition to adding the error message block, we need to add some styling for the error message in ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.css"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"  .errorMessage {\n    background-color: #fe6f5e;\n    border: solid 1px;\n    border-color: #000000;\n    margin-bottom: 10px;\n    margin: 10px;\n  }\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Finally, we need to actually set ",(0,o.kt)("inlineCode",{parentName:"p"},"formFail")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," in areas where the form fails. To do this, we\u2019ll hop back into ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js")," and update our ",(0,o.kt)("inlineCode",{parentName:"p"},"submitForm")," function\u2019s API calls to Fauna and the blockchain so that they have ",(0,o.kt)("inlineCode",{parentName:"p"},".catch()")," statements:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"async function submitForm(data) {\n    ... // some logic exists here\n    // update this snippet that is already within submitForm()\n    await addDocument(uuid, data.firstName, data.lastName, data.walletAddress)\n      .then((res) => {\n        if (!res.ok && res.status >= 400) {\n          setFormFail(true);\n          return;\n        } else {\n          // add data to contract\n          props.contract.methods\n            ._createAllowlister(uuid)\n            .send({ from: props.accounts[0] })\n            .catch(() => {\n              setFormFail(true);\n              return;\n            });\n        }\n      })\n      .catch(() => {\n        setFormFail(true);\n        return;\n      });\n    }\n}\n")))),(0,o.kt)("p",null,"In addition to adding ",(0,o.kt)("inlineCode",{parentName:"p"},".catch")," statements to each API call (",(0,o.kt)("inlineCode",{parentName:"p"},"addDocument")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"_createAllowlister"),"), the code above also adds a block that checks for a scenario where Fauna may not throw an error, but does return an error response (meaning that the API does not return a ",(0,o.kt)("inlineCode",{parentName:"p"},"res.ok")," and that the ",(0,o.kt)("inlineCode",{parentName:"p"},"res.status")," is greater than or equal to a ",(0,o.kt)("inlineCode",{parentName:"p"},"400")," response code, which indicates an error)."),(0,o.kt)("p",null,"Your error messaging will look like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(66400).Z,width:"1414",height:"302"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Success Messaging")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Let\u2019s say we want a success message that surfaces what we submitted in the form within the message - to do so, we\u2019ll need to store what we submitted in the form (first name, last name, and wallet address, which are all strings) as state variables, as well as one to track a successful form submission. To do so, add the following state variable initializations into your code:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const [firstName, setFirstName] = useState("");\nconst [lastName, setLastName] = useState("");\nconst [walletAddress, setWalletAddress] = useState("");\nconst [formSuccess, setFormSuccess] = useState(false);\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Within the ",(0,o.kt)("inlineCode",{parentName:"p"},"wrapper")," div in the ",(0,o.kt)("inlineCode",{parentName:"p"},"return()")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.js"),", just as you added a ",(0,o.kt)("inlineCode",{parentName:"p"},"jsx")," block for the error message, add one for the success message above or below it. The message will surface the form input-related state variables:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'{formSuccess && (\n  <div className="successMessage">\n    <p>\n      Successfully submitted allowlist entry for{" "}\n      {firstName + " " + lastName} with wallet address {walletAddress}!\n    </p>\n  </div>\n)}\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add some styling for the success message in ",(0,o.kt)("inlineCode",{parentName:"p"},"AllowlistForm.css"),":"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},".successMessage {\n  background-color: #e2fee2;\n  border: solid 1px;\n  border-color: #000000;\n  margin-bottom: 10px;\n  margin: 10px;\n}\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Finally, update all of your newly added state variables in a place where, after the API calls are executed, the form is considered fully submitted:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"async function submitForm(data) {\n    ... // some logic exists here\n  await addDocument(uuid, data.firstName, data.lastName, data.walletAddress)\n    .then((res) => {\n      if (!res.ok && res.status >= 400) {\n        setFormFail(true);\n        return;\n      } else {\n        // add data to contract\n        props.contract.methods\n          ._createAllowlister(uuid)\n          .send({ from: props.accounts[0] })\n          .then(() => {\n                        // update this snippet that is already within submitForm()\n            setFirstName(data.firstName);\n            setLastName(data.lastName);\n            setWalletAddress(data.walletAddress);\n            setFormSuccess(true);\n          })\n          .catch(() => {\n            setFormFail(true);\n            return;\n          });\n      }\n    })\n    .catch(() => {\n      setFormFail(true);\n      return;\n    });\n}\n")))),(0,o.kt)("p",null,"The form submission would be considered successful once both the Fauna and Polygon API calls went through. Because of this, we\u2019ve added the logic to set the ",(0,o.kt)("inlineCode",{parentName:"p"},"firstName"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"lastName"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"walletAddress"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"formSuccess")," variables as a ",(0,o.kt)("inlineCode",{parentName:"p"},".then()")," block attached to ",(0,o.kt)("inlineCode",{parentName:"p"},"_createAllowlister")," - this is the last API call that happens before the ",(0,o.kt)("inlineCode",{parentName:"p"},"submitForm")," function ends, and adding in a ",(0,o.kt)("inlineCode",{parentName:"p"},".then()")," ensures that the states are only updated once the last API call has been completed."),(0,o.kt)("p",null,"Your success messaging will look like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:a(37818).Z,width:"1418",height:"332"})),(0,o.kt)("h2",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"We\u2019ve built an allowlisting application in React that takes in private information, securely stores it in a Fauna database, and then submits a public UUID for each property corresponding to the transaction\u2019s database record to the Polygon blockchain. The full GitHub repository for this tutorial can be found ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/hello-ashleyintech/polygon-fauna-app"},"here"),"."),(0,o.kt)("p",null,"If you\u2019re looking to build off of this tutorial or expand the app from here, some great next steps would be to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Write some tests for the Solidity smart contracts"),(0,o.kt)("li",{parentName:"ul"},"Write some tests for the React functionality and components"),(0,o.kt)("li",{parentName:"ul"},"Try adding some additional features, such as:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Surfacing every submitted allowlister and the corresponding UUID info as an easily referenceable guide to find them in Fauna"),(0,o.kt)("li",{parentName:"ul"},"Adding in logic so that if the Polygon API call fails for any reason, then it\u2019ll remove the entry from the Fauna database"),(0,o.kt)("li",{parentName:"ul"},"Adding in logic so that if someone gets a failed submission, and then resubmits and gets a successful submission, the error message goes away and only shows the success message and vice versa")))))}m.isMDXComponent=!0},21664:function(e,t,a){t.Z=a.p+"assets/images/allowlist-fa68d1b3bd8f2d3dd2acf754cfb18b5f.png"},68420:function(e,t,a){t.Z=a.p+"assets/images/allowlist_members-3ac8427515d34bbd1642d5240a1771fa.png"},91283:function(e,t,a){t.Z=a.p+"assets/images/create_database-f93dffd5bdf1630ca697cd8d5153cd87.png"},66400:function(e,t,a){t.Z=a.p+"assets/images/error_msg-4c0522d2278ea52b8455bb63cf310af0.png"},4841:function(e,t,a){t.Z=a.p+"assets/images/faucet-22e9a7bc5f15b4f719e6b3b0f2b96a88.png"},5778:function(e,t,a){t.Z=a.p+"assets/images/flow-eea5375e3494321f93be59658f537786.png"},43235:function(e,t,a){t.Z=a.p+"assets/images/input_data-0bf512d1d36883909e47586ae9e972f1.png"},87226:function(e,t,a){t.Z=a.p+"assets/images/metamask_notification-7470a1b156eb9d9e78508b8d970b24a6.png"},84484:function(e,t,a){t.Z=a.p+"assets/images/metamask_wallet_address-46363073a314fdb746099c66b50e9413.png"},99810:function(e,t,a){t.Z=a.p+"assets/images/new_collection-b5c8985478e5f46f8a0e888a9c154af6.png"},8797:function(e,t,a){t.Z=a.p+"assets/images/new_index-031cf64ecc5c3c458e710925f1ceeb00.png"},97894:function(e,t,a){t.Z=a.p+"assets/images/new_key-2455d216be9e30de4fb8a3a130bc9c35.png"},73465:function(e,t,a){t.Z=a.p+"assets/images/polygon-fauna-app-cebad379be3e0f4234e2f5a2681f5ebe.gif"},21475:function(e,t,a){t.Z=a.p+"assets/images/search_index-dc1fe56e8eb630e1f43750fb190a3db8.png"},37818:function(e,t,a){t.Z=a.p+"assets/images/success_msg-d47a428df34bc7a219dae6e8da5b9dcf.png"},32902:function(e,t,a){t.Z=a.p+"assets/images/transaction_hash-f4bdd320dfc23c53940faa5853a6d72f.png"},78532:function(e,t,a){t.Z=a.p+"assets/images/truffe_box_installed-a56b177e0610ba66dea441732061f71c.png"}}]);