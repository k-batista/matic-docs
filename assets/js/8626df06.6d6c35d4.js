"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[42280],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=i,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},10900:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var a=n(87462),i=n(63366),r=(n(67294),n(3905)),o=["components"],s={id:"antehandler",title:"Ante Handler",description:"Ante Handler checks and validates the transaction",keywords:["docs","matic","polygon","Ante Handler","validate transactions"],image:"https://matic.network/banners/matic-network-16x9.png"},c="Ante Handler",l={unversionedId:"pos/heimdall/antehandler",id:"pos/heimdall/antehandler",title:"Ante Handler",description:"Ante Handler checks and validates the transaction",source:"@site/docs/pos/heimdall/antehandler.md",sourceDirName:"pos/heimdall",slug:"/pos/heimdall/antehandler",permalink:"/matic-docs/docs/pos/heimdall/antehandler",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/pos/heimdall/antehandler.md",tags:[],version:"current",lastUpdatedBy:"Kennedy Batista",lastUpdatedAt:1686621530,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"antehandler",title:"Ante Handler",description:"Ante Handler checks and validates the transaction",keywords:["docs","matic","polygon","Ante Handler","validate transactions"],image:"https://matic.network/banners/matic-network-16x9.png"},sidebar:"pos",previous:{title:"Validator Key Management",permalink:"/matic-docs/docs/pos/heimdall/validator-key-management"},next:{title:"Modules",permalink:"/matic-docs/docs/category/modules"}},d={},p=[{value:"Gas Limit",id:"gas-limit",level:2},{value:"Block Gas Limit",id:"block-gas-limit",level:3},{value:"Transaction Gas Limit",id:"transaction-gas-limit",level:3},{value:"Checkpoint Transaction Gas Limit",id:"checkpoint-transaction-gas-limit",level:3},{value:"Transaction Verification and Replay Protection",id:"transaction-verification-and-replay-protection",level:2}],u={toc:p};function m(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"ante-handler"},"Ante Handler"),(0,r.kt)("p",null,"Ante handler checks and validates the transaction. After the verification, it checks the balance of the sender for enough fees and deduct fees in case of successful transaction inclusion."),(0,r.kt)("h2",{id:"gas-limit"},"Gas Limit"),(0,r.kt)("p",null,"Each block and transaction have a limit for gas usage. A block can contain multiple transactions, but gas used by all transactions in a block must be less than block gas limit to avoid larger blocks. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"block.GasLimit >= sum(tx1.GasUsed + tx2.GasUsed + ..... + txN.GasUsed)\n")),(0,r.kt)("p",null,"Note that each state manipulation on transaction costs gas, including signature verification for the transaction."),(0,r.kt)("h3",{id:"block-gas-limit"},"Block Gas Limit"),(0,r.kt)("p",null,"Max block gas limit and bytes per block is passed while setting up app's consensus params: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/heimdall/blob/develop/app/app.go#L464-L471"},"https://github.com/maticnetwork/heimdall/blob/develop/app/app.go#L464-L471")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"maxGasPerBlock   int64 = 10000000 // 10 Million\nmaxBytesPerBlock int64 = 22020096 // 21 MB\n\n// pass consensus params\nConsensusParams: &abci.ConsensusParams{\n    Block: &abci.BlockParams{\n        MaxBytes: maxBytesPerBlock,\n        MaxGas:   maxGasPerBlock,\n    },\n    ...\n},\n")),(0,r.kt)("h3",{id:"transaction-gas-limit"},"Transaction Gas Limit"),(0,r.kt)("p",null,"The transaction gas limit is defined in params in ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," module. It can be changed through the Heimdall ",(0,r.kt)("inlineCode",{parentName:"p"},"gov")," module."),(0,r.kt)("h3",{id:"checkpoint-transaction-gas-limit"},"Checkpoint Transaction Gas Limit"),(0,r.kt)("p",null,"Since block contains multiple transactions and verifies this particular transaction on the Ethereum chain, Merkle proof is required. To avoid extra Merkle proof verification for checkpoint transaction, Heimdall only allows one transaction in the block if the transaction type is ",(0,r.kt)("inlineCode",{parentName:"p"},"MsgCheckpoint")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'// fee wanted for checkpoint transaction\ngasWantedPerCheckpoinTx sdk.Gas = 10000000 // 10 Million\n\n// checkpoint gas limit\nif stdTx.Msg.Type() == "checkpoint" && stdTx.Msg.Route() == "checkpoint" {\n    gasForTx = gasWantedPerCheckpoinTx\n}\n')),(0,r.kt)("h2",{id:"transaction-verification-and-replay-protection"},"Transaction Verification and Replay Protection"),(0,r.kt)("p",null,"Ante Handler handles and verifies signature in incoming transaction: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/heimdall/blob/develop/auth/ante.go#L230-L266"},"https://github.com/maticnetwork/heimdall/blob/develop/auth/ante.go#L230-L266")),(0,r.kt)("p",null,"Each transaction must include ",(0,r.kt)("inlineCode",{parentName:"p"},"sequenceNumber")," to avoid replay attacks. After each successful transaction inclusion, Ante handler increases the sequence number for the TX sender account to avoid duplication (replay) of the previous transactions."))}m.isMDXComponent=!0}}]);