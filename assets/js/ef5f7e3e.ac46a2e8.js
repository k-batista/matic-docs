"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[46658],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var d=r.createContext({}),l=function(e){var t=r.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,d=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=l(n),h=o,g=u["".concat(d,".").concat(h)]||u[h]||p[h]||a;return n?r.createElement(g,i(i({ref:t},c),{},{components:n})):r.createElement(g,i({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=u;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},37066:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return d},default:function(){return h},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var r=n(87462),o=n(63366),a=(n(67294),n(3905)),i=["components"],s={id:"backup-restore",title:"Backup/restore node instance",description:"How to back up and restore a Polygon Edge node instance.",keywords:["docs","polygon","edge","instance","restore","directory","node"]},d=void 0,l={unversionedId:"edge/working-with-node/backup-restore",id:"edge/working-with-node/backup-restore",title:"Backup/restore node instance",description:"How to back up and restore a Polygon Edge node instance.",source:"@site/docs/edge/working-with-node/backup-restore.md",sourceDirName:"edge/working-with-node",slug:"/edge/working-with-node/backup-restore",permalink:"/matic-docs/docs/edge/working-with-node/backup-restore",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/edge/working-with-node/backup-restore.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686625626,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"backup-restore",title:"Backup/restore node instance",description:"How to back up and restore a Polygon Edge node instance.",keywords:["docs","polygon","edge","instance","restore","directory","node"]},sidebar:"edge",previous:{title:"Query operator information",permalink:"/matic-docs/docs/edge/working-with-node/query-operator-info"},next:{title:"Run a validator",permalink:"/matic-docs/docs/category/run-a-validator"}},c={},p=[{value:"Overview",id:"overview",level:2},{value:"Base folders",id:"base-folders",level:2},{value:"Create backup from a running node and restore for new node",id:"create-backup-from-a-running-node-and-restore-for-new-node",level:2},{value:"Backup",id:"backup",level:3},{value:"Restore",id:"restore",level:3},{value:"Back up/Restore Whole data",id:"back-uprestore-whole-data",level:2},{value:"Step 1: Stop the running client",id:"step-1-stop-the-running-client",level:3},{value:"Step 2: Backup the directory",id:"step-2-backup-the-directory",level:3},{value:"Restore",id:"restore-1",level:2},{value:"Step 1: Stop the running client",id:"step-1-stop-the-running-client-1",level:3},{value:"Step 2: Copy the backed up data directory to the desired folder",id:"step-2-copy-the-backed-up-data-directory-to-the-desired-folder",level:3},{value:"Step 3: Run the Polygon Edge client while specifying the correct data directory",id:"step-3-run-the-polygon-edge-client-while-specifying-the-correct-data-directory",level:3}],u={toc:p};function h(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"This guide goes into detail on how to back up and restore a Polygon Edge node instance.\nIt covers the base folders and what they contain, as well as which files are critical for performing a successful backup and restore."),(0,a.kt)("h2",{id:"base-folders"},"Base folders"),(0,a.kt)("p",null,"Polygon Edge leverages LevelDB as its storage engine.\nWhen starting a Polygon Edge node, the following sub-folders are created in the specified working directory:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"blockchain")," - Stores the blockchain data"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"trie")," - Stores the Merkle tries (world state data)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"keystore")," - Stores private keys for the client. This includes the libp2p private key and the sealing/validator private key"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"consensus")," - Stores any consensus information that the client might need while working. For now, it stores the node's ",(0,a.kt)("em",{parentName:"li"},"private validator key"))),(0,a.kt)("p",null,"It is critical for these folders to be preserved in order for the Polygon Edge instance to run smoothly."),(0,a.kt)("h2",{id:"create-backup-from-a-running-node-and-restore-for-new-node"},"Create backup from a running node and restore for new node"),(0,a.kt)("p",null,"This section guides you through creating archive data of the blockchain in a running node and restoring it in another instance."),(0,a.kt)("h3",{id:"backup"},"Backup"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"backup")," command fetches blocks from a running node by gRPC and generates an archive file. If ",(0,a.kt)("inlineCode",{parentName:"p"},"--from")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"--to")," are not given in the command, this command will fetch blocks from genesis to latest."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ polygon-edge backup --grpc-address 127.0.0.1:9632 --out backup.dat [--from 0x0] [--to 0x100]\n")),(0,a.kt)("h3",{id:"restore"},"Restore"),(0,a.kt)("p",null,"A server imports blocks from an archive at the start when starting with ",(0,a.kt)("inlineCode",{parentName:"p"},"--restore")," flag. Please make sure that there is a key for new node. To find out more about importing or generating keys, visit the ",(0,a.kt)("a",{parentName:"p",href:"/docs/edge/configuration/secret-managers/set-up-aws-ssm"},"Secret Managers section"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ polygon-edge server --restore archive.dat\n")),(0,a.kt)("h2",{id:"back-uprestore-whole-data"},"Back up/Restore Whole data"),(0,a.kt)("p",null,"This section guides you through backup the data including state data and key and restoring into the new instance."),(0,a.kt)("h3",{id:"step-1-stop-the-running-client"},"Step 1: Stop the running client"),(0,a.kt)("p",null,"Since the Polygon Edge uses ",(0,a.kt)("strong",{parentName:"p"},"LevelDB")," for data storage, the node needs to be stopped for the duration of the backup,\nas ",(0,a.kt)("strong",{parentName:"p"},"LevelDB")," doesn't allow for concurrent access to its database files."),(0,a.kt)("p",null,"Additionally, the Polygon Edge also does data flushing on close."),(0,a.kt)("p",null,"The first step involves stopping the running client (either through a service manager or some other mechanism that sends a SIGINT signal to the process),\nso it can trigger 2 events while gracefully shutting down:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Running data flush to disk"),(0,a.kt)("li",{parentName:"ul"},"Release of the DB files lock by LevelDB")),(0,a.kt)("h3",{id:"step-2-backup-the-directory"},"Step 2: Backup the directory"),(0,a.kt)("p",null,"Now that the client is not running, the data directory can be backed up to another medium.\nKeep in mind that the files with a ",(0,a.kt)("inlineCode",{parentName:"p"},".key")," extension contain the private key data that can be used to impersonate the current node,\nand they should never be shared with a third/unknown party."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Please back up and restore the generated ",(0,a.kt)("inlineCode",{parentName:"p"},"genesis")," file manually, so the restored node is fully operational.")),(0,a.kt)("h2",{id:"restore-1"},"Restore"),(0,a.kt)("h3",{id:"step-1-stop-the-running-client-1"},"Step 1: Stop the running client"),(0,a.kt)("p",null,"If any instance of the Polygon Edge is running, it needs to be stopped in order for step 2 to be successful."),(0,a.kt)("h3",{id:"step-2-copy-the-backed-up-data-directory-to-the-desired-folder"},"Step 2: Copy the backed up data directory to the desired folder"),(0,a.kt)("p",null,"Once the client is not running, the data directory which was previously backed up can be copied over to the desired folder.\nAdditionally, restore the previously copied ",(0,a.kt)("inlineCode",{parentName:"p"},"genesis")," file."),(0,a.kt)("h3",{id:"step-3-run-the-polygon-edge-client-while-specifying-the-correct-data-directory"},"Step 3: Run the Polygon Edge client while specifying the correct data directory"),(0,a.kt)("p",null,"In order for the Polygon Edge to use the restored data directory, at launch, the user needs to specify the path to the\ndata directory. Please consult the ",(0,a.kt)("a",{parentName:"p",href:"/docs/edge/get-started/cli-commands"},"CLI Commands")," section on information regarding the ",(0,a.kt)("inlineCode",{parentName:"p"},"data-dir")," flag."))}h.isMDXComponent=!0}}]);