"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[28239],{3905:function(t,e,n){n.d(e,{Zo:function(){return p},kt:function(){return k}});var a=n(67294);function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,o=function(t,e){if(null==t)return{};var n,a,o={},r=Object.keys(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(a=0;a<r.length;a++)n=r[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var s=a.createContext({}),c=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},p=function(t){var e=c(t.components);return a.createElement(s.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(t,e){var n=t.components,o=t.mdxType,r=t.originalType,s=t.parentName,p=l(t,["components","mdxType","originalType","parentName"]),m=c(n),k=o,u=m["".concat(s,".").concat(k)]||m[k]||d[k]||r;return n?a.createElement(u,i(i({ref:e},p),{},{components:n})):a.createElement(u,i({ref:e},p))}));function k(t,e){var n=arguments,o=e&&e.mdxType;if("string"==typeof t||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},31522:function(t,e,n){n.r(e),n.d(e,{assets:function(){return p},contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),i=["components"],l={id:"calling-plasma-contracts",title:"Calling Plasma Contracts",description:"Interact directly with Polygon smart contracts.",keywords:["docs","matic"],image:"https://matic.network/banners/matic-network-16x9.png"},s=void 0,c={unversionedId:"develop/advanced/calling-plasma-contracts",id:"develop/advanced/calling-plasma-contracts",title:"Calling Plasma Contracts",description:"Interact directly with Polygon smart contracts.",source:"@site/docs/develop/advanced/calling-plasma-contracts.md",sourceDirName:"develop/advanced",slug:"/develop/advanced/calling-plasma-contracts",permalink:"/matic-docs/docs/develop/advanced/calling-plasma-contracts",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/develop/advanced/calling-plasma-contracts.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686625626,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"calling-plasma-contracts",title:"Calling Plasma Contracts",description:"Interact directly with Polygon smart contracts.",keywords:["docs","matic"],image:"https://matic.network/banners/matic-network-16x9.png"},sidebar:"develop",previous:{title:"Plasma Contracts",permalink:"/matic-docs/docs/category/plasma-contracts"},next:{title:"Transactions",permalink:"/matic-docs/docs/category/transactions"}},p={},d=[{value:"Important Addresses and Links",id:"important-addresses-and-links",level:2},{value:"Tokens for testing",id:"tokens-for-testing",level:3},{value:"Polygon Explorer",id:"polygon-explorer",level:3},{value:"Workflow",id:"workflow",level:2},{value:"1. Deposit ERC20 token from Goerli to Polygon",id:"1-deposit-erc20-token-from-goerli-to-polygon",level:3},{value:"2. Transfer tokens on Polygon",id:"2-transfer-tokens-on-polygon",level:3},{value:"3. Display account balances for users on Polygon",id:"3-display-account-balances-for-users-on-polygon",level:3},{value:"4. Withdraw ERC20 tokens from Polygon to Goerli",id:"4-withdraw-erc20-tokens-from-polygon-to-goerli",level:3}],m={toc:d};function k(t){var e=t.components,n=(0,o.Z)(t,i);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"For most developers, it is advisable and recommended to use the Matic.js library to interact with Polygon."),(0,r.kt)("p",null,"However, this page helps developers, who have a good understanding of smart contracts in Ethereum, to bypass the Matic.js library and interact directly with the Polygon smart contracts. This might help developers to understand the inner workings of Polygon, as well as to customise their interaction with Polygon to some extent."),(0,r.kt)("h2",{id:"important-addresses-and-links"},"Important Addresses and Links"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Polygon RPC endpoint"),": (Sign up for a free RPC link at ",(0,r.kt)("a",{parentName:"p",href:"https://rpc.maticvigil.com/"},"https://rpc.maticvigil.com/"),")"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Contract"),(0,r.kt)("th",{parentName:"tr",align:null},"ABI"),(0,r.kt)("th",{parentName:"tr",align:null},"Goerli"),(0,r.kt)("th",{parentName:"tr",align:null},"Polygon"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"TEST (ERC20) token"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{target:"_blank",href:"https://static.matic.network/network/testnet/mumbai/artifacts/plasma/ChildERC20.json"},(0,r.kt)("img",{src:"https://img.icons8.com/metro/26/000000/download.png",width:"25px",style:{padding:"2px"}}))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0x3f152B63Ec5CA5831061B2DccFb29a874C317502")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0x2d7882beDcbfDDce29Ba99965dd3cdF7fcB10A1e"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Registry Root Contract"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{target:"_blank",href:"https://static.matic.network/network/testnet/mumbai/artifacts/plasma/Registry.json"},(0,r.kt)("img",{src:"https://img.icons8.com/metro/26/000000/download.png",width:"25px",style:{padding:"2px"}}))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0xeE11713Fe713b2BfF2942452517483654078154D")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DepositManager (Proxy) Contract"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{target:"_blank",href:"https://static.matic.network/network/testnet/mumbai/artifacts/plasma/DepositManager.json"},(0,r.kt)("img",{src:"https://img.icons8.com/metro/26/000000/download.png",width:"25px",style:{padding:"2px"}}))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0x7850ec290A2e2F40B82Ed962eaf30591bb5f5C96")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Child Chain Contract"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{target:"_blank",href:"https://static.matic.network/network/testnet/mumbai/artifacts/plasma/ChildChain.json"},(0,r.kt)("img",{src:"https://img.icons8.com/metro/26/000000/download.png",width:"25px",style:{padding:"2px"}}))),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0x1EDd419627Ef40736ec4f8ceffdE671a30803c5e"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"WithdrawManager (Proxy) Contract"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{target:"_blank",href:"https://static.matic.network/network/testnet/mumbai/artifacts/plasma/WithdrawManager.json"},(0,r.kt)("img",{src:"https://img.icons8.com/metro/26/000000/download.png",width:"25px",style:{padding:"2px"}}))),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"0x2923C8dD6Cdf6b2507ef91de74F1d5E0F11Eac53")),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("h3",{id:"tokens-for-testing"},"Tokens for testing"),(0,r.kt)("p",null,"To get some test tokens on Goerli network, you can access the ",(0,r.kt)("a",{parentName:"p",href:"https://faucet.polygon.technology"},"Polygon Faucet"),"."),(0,r.kt)("h3",{id:"polygon-explorer"},"Polygon Explorer"),(0,r.kt)("p",null,"You can also check transaction procesed on the Polygon Sidechain using the ",(0,r.kt)("a",{parentName:"p",href:"https://mumbai.polygonscan.com/"},"Polygon Explorer"),"."),(0,r.kt)("h2",{id:"workflow"},"Workflow"),(0,r.kt)("h3",{id:"1-deposit-erc20-token-from-goerli-to-polygon"},"1. Deposit ERC20 token from Goerli to Polygon"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description"),": To deposit assets (ERC20) from Goerli to Polygon."),(0,r.kt)("p",null,"Let the required amount of tokens be ",(0,r.kt)("strong",{parentName:"p"},"X"),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The Deposit Manager Contract is approved to spend ",(0,r.kt)("strong",{parentName:"li"},"X")," on behalf of ",(0,r.kt)("inlineCode",{parentName:"li"},"msg.sender"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"ERC20.sol")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"DepositManager.sol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network"),": Goerli"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Function"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"approve"))))),(0,r.kt)("p",null,"Call the standard ",(0,r.kt)("inlineCode",{parentName:"p"},"approve")," function in ERC20 contract, approving ",(0,r.kt)("inlineCode",{parentName:"p"},"DepositManager")," to transfer the amount of tokens."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"RootERC20Contract.methods.approve(\n  this.depositManagerContract.options.address,\n  this.encode(amount)\n);\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The Deposit Manager transfers the amount from ",(0,r.kt)("inlineCode",{parentName:"p"},"msg.sender")," to itself"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"DepositManager.sol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network"),": Goerli"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Function"),": ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/maticnetwork/contracts/blob/6413308db75ecdbf8ab9ec2beee1db0d362acea3/contracts/root/depositManager/DepositManager.sol#L129"},(0,r.kt)("inlineCode",{parentName:"a"},"despositERC20ForUser()")))))),(0,r.kt)("p",null,"Transfer the amount of tokens from msg.sender to DepositManager. Emit ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/contracts/blob/6413308db75ecdbf8ab9ec2beee1db0d362acea3/contracts/root/depositManager/DepositManager.sol#L223"},"NewDepositBlock")," event."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"depositManagerContract.methods.depositERC20ForUser(\n  token,\n  user,\n  this.encode(amount)\n);\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Depositing tokens on Polygon mints new tokens for ChildERC20 contracts on Polygon. ChildERC20 contract is the contract that is deployed with the process of mapping, which is representative of the token present on main network.")),(0,r.kt)("h3",{id:"2-transfer-tokens-on-polygon"},"2. Transfer tokens on Polygon"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description"),": Transfer tokens on Polygon testnet"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Invokes the standard ",(0,r.kt)("inlineCode",{parentName:"li"},"transfer")," function of ERC20 contract.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"ChildERC20.sol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network"),": Polygon"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Function"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"transfer"))))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"ChildERC20.methods\n  .transfer(\n    recipientAddress,\n    this.encode(amount)\n  )\n")),(0,r.kt)("h3",{id:"3-display-account-balances-for-users-on-polygon"},"3. Display account balances for users on Polygon"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description"),": Query ERC20 token balances for user on Polygon and Goerli"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Invokes the standard ",(0,r.kt)("inlineCode",{parentName:"li"},"balanceOf")," function of ERC20 contract.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"ChildERC20.sol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network"),": Polygon"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Function"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"balanceOf"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// ERC20TokenContract can be either on Goerli or Polygon\nERC20TokenContract.methods.balanceOf(owner);\n")))))),(0,r.kt)("h3",{id:"4-withdraw-erc20-tokens-from-polygon-to-goerli"},"4. Withdraw ERC20 tokens from Polygon to Goerli"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description"),": Withdraw assets (ERC20) from Polygon testnet to Goerli"),(0,r.kt)("p",null,"Procedure of Withdrawal:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Burn tokens on Polygon sidechain"),(0,r.kt)("li",{parentName:"ol"},"Submit proof of burn (the receipt of burn tx) on Root Chain",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"This step is executed only after the block consisting of the burn tx has been included in a checkpoint on the Root Chain."),(0,r.kt)("li",{parentName:"ol"},"After checkpoint submission, a successful execution of this step",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"marks the initiation of the Challenge Exit Period (which is a 7-day period on main network, and set to 5 minute on test networks)"),(0,r.kt)("li",{parentName:"ol"},"Mints an ",(0,r.kt)("inlineCode",{parentName:"li"},"ExitNFT")," token to the exitor's account - which is representative of the exit initiated on the child chain by the exitor"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"processExits")," burns the Exit NFT and transfers the tokens back from Deposit manager to the exitor.")))),(0,r.kt)("p",null,"Let ",(0,r.kt)("strong",{parentName:"p"},"X")," be the amount of tokens to be withdrawn."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Submit withdraw request of ",(0,r.kt)("strong",{parentName:"p"},"X")," tokens on Polygon - burns the tokens and returns a tx ID."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"ChildERC20.sol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network"),": Polygon"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Function"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"withdraw"))),(0,r.kt)("p",{parentName:"li"},"Burns tokens on Polygon and emits ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/contracts/blob/6413308db75ecdbf8ab9ec2beee1db0d362acea3/contracts/child/ChildERC20.sol#L52"},"Withdraw")," event."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"ChildToken.methods.withdraw(amount);\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use tx ID from previous step to create a withdraw transaction on Goerli"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"ERC20Predicate.sol")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network"),": Goerli"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Function"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"startExitWithBurntTokens"))),(0,r.kt)("p",{parentName:"li"},"The function accepts payload data, which is the proof of burn of tokens performed in the previous transaction. This payload is generated off-chain."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"payload = await _buildPayloadForExit(burnTxHash);\nerc20PredicateContract.methods.startExitWithBurntTokens(payload);\n")),(0,r.kt)("p",{parentName:"li"},"To build payload for the exit:"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Get last child block from RootChain.sol - this is the number of blocks which was checkpointed last on the root chain."),(0,r.kt)("li",{parentName:"ol"},"If the last checkpointed block is less than the block containing the burn transaction - wait until the block is checkpointed."),(0,r.kt)("li",{parentName:"ol"},"If the checkpoint has been included",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"find ",(0,r.kt)("inlineCode",{parentName:"li"},"HeaderBlockNumber")," from RootChain.sol",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"From the last checkpointed block to the block consisting of burn transaction perform search (Matic.js performs a binary search) to find the block with the burn tx."),(0,r.kt)("li",{parentName:"ol"},"Query RootChain.sol with the header block number"))),(0,r.kt)("li",{parentName:"ol"},"Build Block Proof, sample: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/maticnetwork/contracts/blob/fa6862dc6ddae97351aa1b4d16c087861b5a489e/contracts-core/helpers/proofs.js#L24"},"https://github.com/maticnetwork/contracts/blob/fa6862dc6ddae97351aa1b4d16c087861b5a489e/contracts-core/helpers/proofs.js#L24")),(0,r.kt)("li",{parentName:"ol"},"Build Receipt Proof, sample: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/maticnetwork/contracts/blob/fa6862dc6ddae97351aa1b4d16c087861b5a489e/contracts-core/helpers/proofs.js#L106"},"https://github.com/maticnetwork/contracts/blob/fa6862dc6ddae97351aa1b4d16c087861b5a489e/contracts-core/helpers/proofs.js#L106")))),(0,r.kt)("li",{parentName:"ol"},"Return hex-encoded string of bytes: ",(0,r.kt)("inlineCode",{parentName:"li"},"headernumber"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"blockProof"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"block number of burn transaction"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"timestamp of the burn tx block"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"root of block"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"root of receipts"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"RLP encoded receipt bytes"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"receipt parent nodes"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"receipt path"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"logIndex"))),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"private async _buildPayloadForExit(burnTxHash) {\n  // check checkpoint\n  const lastChildBlock = await rootChain.getLastChildBlock()\n  const burnTx = await web3.eth.getTransaction(burnTxHash)\n  const receipt = await web3.eth.getTransactionReceipt(burnTxHash)\n  const block = await web3.eth.getBlock(\n    burnTx.blockNumber,\n    true /* returnTransactionObjects */\n  )\n\n  // check here if the burn tx has been checkpointed or not\n  logger.info( { 'burnTx.blockNumber': burnTx.blockNumber, lastCheckPointedBlockNumber: lastChildBlock } )\n  assert.ok(\n    new BN(lastChildBlock).gte(new BN(burnTx.blockNumber)),\n    'Burn transaction has not been checkpointed as yet',\n  )\n    // if the block has been checkpointed, move ahead\n\n    const headerBlockNumber = await rootChainContract.findHeaderBlockNumber(burnTx.blockNumber)\n    const headerBlock = await web3.call(\n      rootChainContract\n        .getRawContract()\n        .methods.headerBlocks(this.encode(headerBlockNumber)),\n    )\n    logger.info({ 'headerBlockNumber': headerBlockNumber.toString(), headerBlock })\n\n      // build block proof\n      const blockProof = await Proofs.buildBlockProof(\n        this.web3Client.getMaticWeb3(),\n        headerBlock.start,\n        headerBlock.end,\n        burnTx.blockNumber,\n      )\n      // build receipt proof\n      const receiptProof = await Proofs.getReceiptProof(\n        receipt,\n        block,\n        this.web3Client.getMaticWeb3(),\n      )\n      return this._encodePayload(\n        headerBlockNumber,\n        blockProof,\n        burnTx.blockNumber,\n        block.timestamp,\n        Buffer.from(block.transactionsRoot.slice(2), 'hex'),\n        Buffer.from(block.receiptsRoot.slice(2), 'hex'),\n        Proofs.getReceiptBytes(receipt), // rlp encoded\n        receiptProof.parentNodes,\n        receiptProof.path,\n        // @todo logIndex can vary\n        1, // logIndex\n      )\n    }\n  ```\n\n  To encode payload (returned in the previous function)\n\n  ```javascript\n    function _encodePayload(\n      headerNumber,\n      buildBlockProof,\n      blockNumber,\n      timestamp,\n      transactionsRoot,\n      receiptsRoot,\n      receipt,\n      receiptParentNodes,\n      path,\n      logIndex,\n    ) {\n      return ethUtils.bufferToHex(\n        ethUtils.rlp.encode([\n          headerNumber,\n          buildBlockProof,\n          blockNumber,\n          timestamp,\n          ethUtils.bufferToHex(transactionsRoot),\n          ethUtils.bufferToHex(receiptsRoot),\n          ethUtils.bufferToHex(receipt),\n          ethUtils.bufferToHex(ethUtils.rlp.encode(receiptParentNodes)),\n          ethUtils.bufferToHex(ethUtils.rlp.encode(path)),\n          logIndex,\n        ]),\n      )\n    }\n\n    ```\n\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Process Exits"),(0,r.kt)("p",{parentName:"li"},"Third and final step for the withdrawal process is to process pending exits on the root chain."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Contract"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"WithdrawManager.sol"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Network"),": Goerli")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Function"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"processExits")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"withdrawManager.methods.processExits(token);\n")))))))}k.isMDXComponent=!0}}]);