"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[64312],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var d=a.createContext({}),p=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(d.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=o,u=c["".concat(d,".").concat(m)]||c[m]||h[m]||i;return n?a.createElement(u,r(r({ref:t},s),{},{components:n})):a.createElement(u,r({ref:t},s))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},65126:function(e,t,n){n.r(t),n.d(t,{assets:function(){return h},contentTitle:function(){return p},default:function(){return u},frontMatter:function(){return d},metadata:function(){return s},toc:function(){return c}});var a=n(87462),o=n(63366),i=(n(67294),n(3905)),r=n(44996),l=["components"],d={id:"how-to",title:"Pre-requisites & How Tos",description:"Polygon validator tutorials",keywords:["docs","polygon","how to","knowledge","faq","node","validator"],slug:"how-to",image:"https://wiki.polygon.technology/img/polygon-logo.png"},p=void 0,s={unversionedId:"maintain/validate/kb/how-to",id:"maintain/validate/kb/how-to",title:"Pre-requisites & How Tos",description:"Polygon validator tutorials",source:"@site/docs/maintain/validate/kb/how-to.md",sourceDirName:"maintain/validate/kb",slug:"/maintain/validate/kb/how-to",permalink:"/matic-docs/docs/maintain/validate/kb/how-to",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/maintain/validate/kb/how-to.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686625626,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"how-to",title:"Pre-requisites & How Tos",description:"Polygon validator tutorials",keywords:["docs","polygon","how to","knowledge","faq","node","validator"],slug:"how-to",image:"https://wiki.polygon.technology/img/polygon-logo.png"},sidebar:"maintain",previous:{title:"Known Issues & Errors",permalink:"/matic-docs/docs/maintain/validate/kb/known-issues"},next:{title:"Additional Information",permalink:"/matic-docs/docs/category/additional-information"}},h={},c=[{value:"1. How to: New node setup",id:"1-how-to-new-node-setup",level:3},{value:"2. Why do I have to keep ETH in my signer account?",id:"2-why-do-i-have-to-keep-eth-in-my-signer-account",level:3},{value:"3. For a Polygon Validator, do I need to setup a Sentry and Validator node or can I just run the Validator node only?",id:"3-for-a-polygon-validator-do-i-need-to-setup-a-sentry-and-validator-node-or-can-i-just-run-the-validator-node-only",level:3},{value:"4. How to migrate to new nodes and then cut over?",id:"4-how-to-migrate-to-new-nodes-and-then-cut-over",level:3},{value:"5. How to check the Heimdall version?",id:"5-how-to-check-the-heimdall-version",level:3},{value:"6. Which Private Key should we add when we generate validator key?",id:"6-which-private-key-should-we-add-when-we-generate-validator-key",level:3},{value:"7. Where can we find Heimdall account info location?",id:"7-where-can-we-find-heimdall-account-info-location",level:3},{value:"8. Which file do we add the API key?",id:"8-which-file-do-we-add-the-api-key",level:3},{value:"9. Which file do we add the <code>persistent_peers</code>?",id:"9-which-file-do-we-add-the-persistent_peers",level:3},{value:"10. How to stop Heimdall and Bor services?",id:"10-how-to-stop-heimdall-and-bor-services",level:3},{value:"11. How to remove Heimdall and Bor directories?",id:"11-how-to-remove-heimdall-and-bor-directories",level:3},{value:"12. How to reduce cache in Bor?",id:"12-how-to-reduce-cache-in-bor",level:3},{value:"13. How to delete the Bor DB data?",id:"13-how-to-delete-the-bor-db-data",level:3}],m={toc:c};function u(e){var t=e.components,n=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"1-how-to-new-node-setup"},"1. How to: New node setup"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Below are some additional information to the official documentation which might help while setting up a new node.")),(0,i.kt)("p",null,"This document gives some additional details for setting up a new node based on ",(0,i.kt)("a",{parentName:"p",href:"/matic-docs/docs/operate/full-node-deployment"},"Full Node Deployment")," guide."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"VPN setup is required before proceeding with any of these steps can be done by referring ",(0,i.kt)("a",{parentName:"p",href:"https://www.notion.so/Bastillion-VPN-user-guide-c04f5f26afda4fa59d5d9f6041327f43"},"Bastillion user guide"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If you are using Macbook, it has native Python 2.7 available which ",(0,i.kt)("strong",{parentName:"p"},"needs to be replaced by with anything Python 3.x"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Make sure if pip3 packages are installed correctly"),(0,i.kt)("p",{parentName:"li"},"  If the above 3 steps are not done correctly then even though Ansible is installed, it can\u2019t recognize the Ansible packages. You might face something like the below screenshot:"),(0,i.kt)("img",{src:(0,r.Z)("img/knowledge-base/node-setup-1.png"),width:"100%",height:"100%"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Also make sure there are no Go packages and any previous setup of Bor or Heimdall."),(0,i.kt)("p",{parentName:"li"},"  You can use the below commands to check whether these packages are existing or not;"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go version")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Heimdall version")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Bor version"),(0,i.kt)("p",{parentName:"li"},"If anything of that sort, please run the below command to delete and clean the whole setup;"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ansible-playbook -l sentry playbooks/clean.yml\n")),(0,i.kt)("p",{parentName:"li"},"Otherwise there will be error like below image whenever you try to run ",(0,i.kt)("inlineCode",{parentName:"p"},"ansible sentry -m ping")),(0,i.kt)("img",{src:(0,r.Z)("img/knowledge-base/node-setup-2.png"),width:"100%",height:"100%"})))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Example of ",(0,i.kt)("strong",{parentName:"p"},"inventory.yml")),(0,i.kt)("img",{src:(0,r.Z)("img/knowledge-base/node-setup-3.png"),width:"100%",height:"100%"})),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Sentry Host IP and Validator Host IP have to be the same and colons should be provided at the end of the lines including IPs")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Before connecting the remote machine using the below command, you must be added to the remote machine and it will provided by DevOps team"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ssh -i <downloaded_key_file.key> <remote_user>@<ip/host>\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Once they have confirmed the server access, you should be able to SSH to the remote machine.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"You may face this error if there is any issue with Heimdall's config"),(0,i.kt)("img",{src:(0,r.Z)("img/knowledge-base/node-setup-4.png"),width:"100%",height:"100%"}),(0,i.kt)("p",{parentName:"li"},"  This can be fixed by following steps:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Run the below commands(inside the 'node-ansible' folder):"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git checkout fixing_symlinks_on_clean\ngit pull https://github.com/maticnetwork/node-ansible/tree/fixing_symlinks_on_\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Cross check ",(0,i.kt)("inlineCode",{parentName:"p"},"clean.yml")," on your machine with ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/node-ansible/blob/fixing_symlinks/playbooks/clean.yml"},"clean.yml in the github repo"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If there are any differences, replace the one on your machine with the one in the repo")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"You should be able to run the clean script now and then also be able to run the installation script")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"moniker=enter unique identifier")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"the unique identifier asked as per the document (it can be anything, ex: your name)"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"eth_rpc_url =insert Infura or any full node RPC URL to Ethereum")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"For this step, sign in to ",(0,i.kt)("a",{parentName:"p",href:"https://infura.io"},"https://infura.io")," (signup if you already don't have an account)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Copy the ",(0,i.kt)("strong",{parentName:"p"},"https")," endpoint provided under ",(0,i.kt)("strong",{parentName:"p"},"ethereum \u2192 keys \u2192 endpoints")),(0,i.kt)("img",{src:(0,r.Z)("img/knowledge-base/node-setup-5.png"),width:"100%",height:"100%"}),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Provide the copied ",(0,i.kt)("strong",{parentName:"li"},"https")," endpoint as ",(0,i.kt)("inlineCode",{parentName:"li"},"eth_rpc_url")," in ",(0,i.kt)("inlineCode",{parentName:"li"},"/var/lib/heimdall/config/heimdall-config.toml"))))))),(0,i.kt)("h3",{id:"2-why-do-i-have-to-keep-eth-in-my-signer-account"},"2. Why do I have to keep ETH in my signer account?"),(0,i.kt)("p",null,"ETH is required on your signer account because for submitting checkpoints to Ethereum, all transactions require ETH to be used as Gas. Hence, ETH is required in your Signer Account."),(0,i.kt)("h3",{id:"3-for-a-polygon-validator-do-i-need-to-setup-a-sentry-and-validator-node-or-can-i-just-run-the-validator-node-only"},"3. For a Polygon Validator, do I need to setup a Sentry and Validator node or can I just run the Validator node only?"),(0,i.kt)("p",null,"For a Polygon Validator, our ecosystem and architecture demands that you run a ",(0,i.kt)("strong",{parentName:"p"},"Sentry + Validator")," setup. This is to ensure that your Validator node is not exposed to the public and only your Sentry node is."),(0,i.kt)("p",null,"Your Sentry node gleans information / blocks from the network and then relays them to the Validator for validation."),(0,i.kt)("h3",{id:"4-how-to-migrate-to-new-nodes-and-then-cut-over"},"4. How to migrate to new nodes and then cut over?"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Provision nodes and install all software as per the instructions.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Download the latest Heimdall and Bor snapshots on both nodes.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Move the Key and Keystore files to the new validator.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Shut down the current validator and sentry node.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Start all services on sentry, then the validator."))),(0,i.kt)("h3",{id:"5-how-to-check-the-heimdall-version"},"5. How to check the Heimdall version?"),(0,i.kt)("p",null,"Run: ",(0,i.kt)("inlineCode",{parentName:"p"},"heimdalld version")),(0,i.kt)("h3",{id:"6-which-private-key-should-we-add-when-we-generate-validator-key"},"6. Which Private Key should we add when we generate validator key?"),(0,i.kt)("p",null,"The Private key to be used is your Wallet's ETH address where your Matic testnet Tokens are stored. You can complete the setup with one public-private key pair tied to the address submitted on the form."),(0,i.kt)("h3",{id:"7-where-can-we-find-heimdall-account-info-location"},"7. Where can we find Heimdall account info location?"),(0,i.kt)("p",null,"For Binaries: ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.heimdalld/config folder")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"/var/lib/heimdall/config folder\n")),(0,i.kt)("p",null,"For Linux package:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"/etc/heimdall/config\n")),(0,i.kt)("h3",{id:"8-which-file-do-we-add-the-api-key"},"8. Which file do we add the API key?"),(0,i.kt)("p",null,"Once you have created the API key, you need to add the API key in\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"heimdall-config.toml"),"\xa0file."),(0,i.kt)("h3",{id:"9-which-file-do-we-add-the-persistent_peers"},"9. Which file do we add the ",(0,i.kt)("inlineCode",{parentName:"h3"},"persistent_peers"),"?"),(0,i.kt)("p",null,"You can add the ",(0,i.kt)("inlineCode",{parentName:"p"},"persistent_peers")," in the following file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"/var/lib/heimdall/config/config.toml\n")),(0,i.kt)("h3",{id:"10-how-to-stop-heimdall-and-bor-services"},"10. How to stop Heimdall and Bor services?"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"For Linux packages"),":"),(0,i.kt)("p",null,"Stop Heimdall:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sudo service heimdalld stop")),(0,i.kt)("p",null,"Stop Bor:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sudo service bor stop"),"\xa0or"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"ps -aux | grep bor"),". Get the PID for Bor and then run the following command."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"sudo kill -9 PID"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"For Binaries"),":"),(0,i.kt)("p",null,"Stop Heimdall:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"pkill heimdalld")),(0,i.kt)("p",null,"Stop Bridge:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"pkill heimdalld-bridge")),(0,i.kt)("p",null,"Stop Bor: \xa0",(0,i.kt)("inlineCode",{parentName:"p"},"bash stop.sh")),(0,i.kt)("h3",{id:"11-how-to-remove-heimdall-and-bor-directories"},"11. How to remove Heimdall and Bor directories?"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"For Linux packages"),":"),(0,i.kt)("p",null,"Delete Heimdall:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sudo rm -rf /etc/heimdall/*")),(0,i.kt)("p",null,"Delete Bor:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sudo rm -rf /etc/bor/*")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"For Binaries"),":"),(0,i.kt)("p",null,"Delete Heimdall:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sudo rm -rf /var/lib/heimdall/")),(0,i.kt)("p",null,"Delete Bor:\xa0",(0,i.kt)("inlineCode",{parentName:"p"},"sudo rm -rf /var/lib/bor")),(0,i.kt)("h3",{id:"12-how-to-reduce-cache-in-bor"},"12. How to reduce cache in Bor?"),(0,i.kt)("p",null,"Bor supports the ",(0,i.kt)("inlineCode",{parentName:"p"},"--cache")," parameter which can reduce the cache to avoid running out of memory."),(0,i.kt)("h3",{id:"13-how-to-delete-the-bor-db-data"},"13. How to delete the Bor DB data?"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"bor --datadir  /var/lib/bor/data removedb\ncd ~/node/bor\nbash setup.sh\nservice bor start\n")))}u.isMDXComponent=!0}}]);