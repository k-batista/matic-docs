"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[56355],{3905:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return h}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),d=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},s=function(e){var n=d(e.components);return r.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=d(t),h=a,m=u["".concat(c,".").concat(h)]||u[h]||p[h]||o;return t?r.createElement(m,i(i({ref:n},s),{},{components:t})):r.createElement(m,i({ref:n},s))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var d=2;d<o;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},57899:function(e,n,t){t.r(n),t.d(n,{assets:function(){return s},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return p}});var r=t(87462),a=t(63366),o=(t(67294),t(3905)),i=["components"],l={id:"setup",title:"Setup",description:"How to setup chainBridge",keywords:["docs","polygon","edge","Bridge"]},c=void 0,d={unversionedId:"edge/additional-features/chainbridge/setup",id:"edge/additional-features/chainbridge/setup",title:"Setup",description:"How to setup chainBridge",source:"@site/docs/edge/additional-features/chainbridge/setup.md",sourceDirName:"edge/additional-features/chainbridge",slug:"/edge/additional-features/chainbridge/setup",permalink:"/matic-docs/docs/edge/additional-features/chainbridge/setup",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/edge/additional-features/chainbridge/setup.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686624865,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"setup",title:"Setup",description:"How to setup chainBridge",keywords:["docs","polygon","edge","Bridge"]},sidebar:"edge",previous:{title:"General Definitions",permalink:"/matic-docs/docs/edge/additional-features/chainbridge/definitions"},next:{title:"ERC20 Token Transfer",permalink:"/matic-docs/docs/edge/additional-features/chainbridge/setup-erc20-transfer"}},s={},p=[{value:"Contracts deployment",id:"contracts-deployment",level:2},{value:"Relayer setup",id:"relayer-setup",level:2}],u={toc:p};function h(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"contracts-deployment"},"Contracts deployment"),(0,o.kt)("p",null,"In this section, you will deploy the required contracts to the Polygon PoS and Polygon Edge chain with ",(0,o.kt)("inlineCode",{parentName:"p"},"cb-sol-cli"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Setup for cb-sol-cli command\n$ git clone https://github.com/ChainSafe/chainbridge-deploy.git\n$ cd chainbridge-deploy/cb-sol-cli\n$ make install\n")),(0,o.kt)("p",null,"Firstly, we will deploy contracts to the Polygon PoS chain by ",(0,o.kt)("inlineCode",{parentName:"p"},"cb-sol-cli deploy")," command.  ",(0,o.kt)("inlineCode",{parentName:"p"},"--all")," flag makes the command deploy all the contracts, including Bridge, ERC20 Handler, ERC721 Handler, Generic Handler, ERC20, and ERC721 contract. In addition, it'll set the default relayer account address and the threshold"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Deploy all required contracts into Polygon PoS chain\n$ cb-sol-cli deploy --all --chainId 99 \\\n  --url https://rpc-mumbai.matic.today \\\n  --gasPrice [GAS_PRICE] \\\n  --privateKey [ADMIN_ACCOUNT_PRIVATE_KEY] \\\n  --relayers [RELAYER_ACCOUNT_ADDRESS] \\\n  --relayerThreshold 1\n")),(0,o.kt)("p",null,"Learn about chainID and JSON-RPC URL ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/additional-features/chainbridge/definitions"},"here")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The default gas price in ",(0,o.kt)("inlineCode",{parentName:"p"},"cb-sol-cli")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"20000000")," (",(0,o.kt)("inlineCode",{parentName:"p"},"0.02 Gwei"),"). To set the appropriate gas price in a transaction, please set the value using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--gasPrice")," argument."),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cb-sol-cli deploy --all --chainId 99 \\\n  --url https://rpc-mumbai.matic.today \\\n  --privateKey [ADMIN_ACCOUNT_PRIVATE_KEY] \\\n  --relayers [RELAYER_ACCOUNT_ADDRESS] \\\n  --relayerThreshold 1 \\\n  # Set gas price to 5 Gwei\n  --gasPrice 5000000000\n"))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The Bridge contract takes approximately 0x3f97b8 (4167608) gas to deploy. Please make sure the blocks being generated have enough block gas limit to contain the contract creation transaction. To learn more about changing block gas limit in Polygon Edge, please visit\nthe ",(0,o.kt)("a",{parentName:"p",href:"/docs/edge/get-started/set-up-ibft-locally"},"Local Setup")," ")),(0,o.kt)("p",null,"Once the contracts have been deployed, you will get the following result:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"Deploying contracts...\n\u2713 Bridge contract deployed\n\u2713 ERC20Handler contract deployed\n\u2713 ERC721Handler contract deployed\n\u2713 GenericHandler contract deployed\n\u2713 ERC20 contract deployed\nWARNING: Multiple definitions for safeTransferFrom\n\u2713 ERC721 contract deployed\n\n================================================================\nUrl:        https://rpc-mumbai.matic.today\nDeployer:   <ADMIN_ACCOUNT_ADDRESS>\nGas Limit:   8000000\nGas Price:   20000000\nDeploy Cost: 0.00029065308\n\nOptions\n=======\nChain Id:    <CHAIN_ID>\nThreshold:   <RELAYER_THRESHOLD>\nRelayers:    <RELAYER_ACCOUNT_ADDRESS>\nBridge Fee:  0\nExpiry:      100\n\nContract Addresses\n================================================================\nBridge:             <BRIDGE_CONTRACT_ADDRESS>\n----------------------------------------------------------------\nErc20 Handler:      <ERC20_HANDLER_CONTRACT_ADDRESS>\n----------------------------------------------------------------\nErc721 Handler:     <ERC721_HANDLER_CONTRACT_ADDRESS>\n----------------------------------------------------------------\nGeneric Handler:    <GENERIC_HANDLER_CONTRACT_ADDRESS>\n----------------------------------------------------------------\nErc20:              <ERC20_CONTRACT_ADDRESS>\n----------------------------------------------------------------\nErc721:             <ERC721_CONTRACT_ADDRESS>\n----------------------------------------------------------------\nCentrifuge Asset:   Not Deployed\n----------------------------------------------------------------\nWETC:               Not Deployed\n================================================================\n")),(0,o.kt)("p",null,"Now we may deploy the contracts to the Polygon Edge chain."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Deploy all required contracts into Polygon Edge chain\n$ cb-sol-cli deploy --all --chainId 100 \\\n  --url http://localhost:10002 \\\n  --privateKey [ADMIN_ACCOUNT_PRIVATE_KEY] \\\n  --relayers [RELAYER_ACCOUNT_ADDRESS] \\\n  --relayerThreshold 1\n")),(0,o.kt)("p",null,"Save the terminal outputs with the deployed smart contract addresses as we will need them for the next step."),(0,o.kt)("h2",{id:"relayer-setup"},"Relayer setup"),(0,o.kt)("p",null,"In this section, you will start a relayer to exchange data between 2 chains. "),(0,o.kt)("p",null,"First, we need to clone and build the ChainBridge repository."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/ChainSafe/ChainBridge.git\n$ cd chainBridge && make install\n")),(0,o.kt)("p",null,"Next, You need to create ",(0,o.kt)("inlineCode",{parentName:"p"},"config.json")," and set the JSON-RPC URLs, relayer address, and contracts address for each chain."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "chains": [\n    {\n      "name": "mumbai",\n      "type": "ethereum",\n      "id": "99",\n      "endpoint": "https://rpc-mumbai.matic.today",\n      "from": "<RELAYER_ACCOUNT_ADDRESS>",\n      "opts": {\n        "bridge": "<BRIDGE_CONTRACT_ADDRESS>",\n        "erc20Handler": "<ERC20_HANDLER_CONTRACT_ADDRESS>",\n        "erc721Handler": "<ERC721_HANDLER_CONTRACT_ADDRESS>",\n        "genericHandler": "<GENERIC_HANDLER_CONTRACT_ADDRESS>",\n        "minGasPrice": "1",\n        "http": "true"\n      }\n    },\n    {\n      "name": "polygon-edge",\n      "type": "ethereum",\n      "id": "100",\n      "endpoint": "http://localhost:10002",\n      "from": "<RELAYER_ACCOUNT_ADDRESS>",\n      "opts": {\n        "bridge": "<BRIDGE_CONTRACT_ADDRESS>",\n        "erc20Handler": "<ERC20_HANDLER_CONTRACT_ADDRESS>",\n        "erc721Handler": "<ERC721_HANDLER_CONTRACT_ADDRESS>",\n        "genericHandler": "<GENERIC_HANDLER_CONTRACT_ADDRESS>",\n        "minGasPrice": "1",\n        "http": "true"\n      }\n    }\n  ]\n}\n')),(0,o.kt)("p",null,"To start a relayer, you need to import the private key corresponding to the relayer account address. You will need to input the password when you import private key. Once the import has been successful, the key will be stored under ",(0,o.kt)("inlineCode",{parentName:"p"},"keys/<ADDRESS>.key"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Import private key and store to local with encryption\n$ chainbridge accounts import --privateKey [RELAYER_ACCOUNT_PRIVATE_KEY]\n\nINFO[11-19|07:09:01] Importing key... \nEnter password to encrypt keystore file:\n> [PASSWORD_TO_ENCRYPT_KEY]\nINFO[11-19|07:09:05] private key imported                     address=<RELAYER_ACCOUNT_ADDRESS> file=.../keys/<RELAYER_ACCOUNT_ADDRESS>.key\n")),(0,o.kt)("p",null,"Then, you can start the relayer. You will need to input the same password you chose for storing the key in the beginning."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"# Start relayer\n$ chainbridge --config config.json --latest\n\nINFO[11-19|07:15:19] Starting ChainBridge... \nEnter password for key ./keys/<RELAYER_ACCOUNT_ADDRESS>.key:\n> [PASSWORD_TO_DECRYPT_KEY]\nINFO[11-19|07:15:25] Connecting to ethereum chain...          chain=mumbai url=<JSON_RPC_URL>\nEnter password for key ./keys/<RELAYER_ACCOUNT_ADDRESS>.key:\n> [PASSWORD_TO_DECRYPT_KEY]\nINFO[11-19|07:15:31] Connecting to ethereum chain...          chain=polygon-edge url=<JSON_RPC_URL>\n")),(0,o.kt)("p",null,"Once the relayer has begun, it will start to watch new blocks on each chain."))}h.isMDXComponent=!0}}]);