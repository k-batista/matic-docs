"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[6479],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,f=u["".concat(s,".").concat(m)]||u[m]||c[m]||r;return n?a.createElement(f,l(l({ref:t},d),{},{components:n})):a.createElement(f,l({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,l=new Array(r);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},42883:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return p},default:function(){return f},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return u}});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),l=n(44996),i=["components"],s={id:"full-node-deployment",title:"Run a Full Node using Ansible",sidebar_label:"Using Ansible",description:"Deploy a Full Node using Ansible",keywords:["docs","polygon","matic","node","full node setup","ansible","deploy"],image:"https://wiki.polygon.technology/img/polygon-wiki.png"},p=void 0,d={unversionedId:"operate/full-node-deployment",id:"operate/full-node-deployment",title:"Run a Full Node using Ansible",description:"Deploy a Full Node using Ansible",source:"@site/docs/operate/full-node-deployment.md",sourceDirName:"operate",slug:"/operate/full-node-deployment",permalink:"/matic-docs/docs/operate/full-node-deployment",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/operate/full-node-deployment.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686626387,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"full-node-deployment",title:"Run a Full Node using Ansible",sidebar_label:"Using Ansible",description:"Deploy a Full Node using Ansible",keywords:["docs","polygon","matic","node","full node setup","ansible","deploy"],image:"https://wiki.polygon.technology/img/polygon-wiki.png"},sidebar:"operatepos",previous:{title:"Run a Full Node",permalink:"/matic-docs/docs/category/run-a-full-node"},next:{title:"Using Binaries",permalink:"/matic-docs/docs/operate/full-node-binaries"}},c={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Full node setup",id:"full-node-setup",level:2},{value:"Logs",id:"logs",level:2},{value:"Ports and Firewall Setup",id:"ports-and-firewall-setup",level:2}],m={toc:u};function f(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This tutorial guides you through starting and running a full node using Ansible."),(0,r.kt)("p",null,"An ",(0,r.kt)("a",{parentName:"p",href:"https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html"},"Ansible playbook")," is used to\nconfigure and manage a full node. See the ",(0,r.kt)("a",{parentName:"p",href:"/matic-docs/docs/operate/technical-requirements"},"Minimum Technical Requirements")," guide for the system requirements."),(0,r.kt)("admonition",{title:"Snapshots",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Steps in this guide involve waiting for the Heimdall and Bor services to sync fully. This process takes several days to complete."),(0,r.kt)("p",{parentName:"admonition"},"Please use snapshots for faster syncing without having to sync over the network. For detailed instructions, see ",(0,r.kt)("a",{parentName:"p",href:"/matic-docs/docs/operate/snapshot-instructions-heimdall-bor"},(0,r.kt)("ins",null,"Snapshot Instructions for Heimdall and Bor")),"."),(0,r.kt)("p",{parentName:"admonition"},"For snapshot download links, see the ",(0,r.kt)("a",{parentName:"p",href:"https://snapshot.polygon.technology/"},(0,r.kt)("ins",null,"Polygon Chains Snapshots"))," page.")),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Install Ansible on your local machine with Python3.x. The setup will not work if you have Python2.x.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"To install Ansible with Python 3.x, you can use pip. If you do not have pip on your machine,\nfollow the steps outlined ",(0,r.kt)("a",{parentName:"li",href:"https://pip.pypa.io/en/stable/"},"here"),". Run ",(0,r.kt)("inlineCode",{parentName:"li"},"pip3 install ansible")," to install\nAnsible."))),(0,r.kt)("li",{parentName:"ul"},"Check the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/maticnetwork/node-ansible#requirements"},"Polygon PoS Ansible repository")," for\nrequirements."),(0,r.kt)("li",{parentName:"ul"},"You will also need to ensure that Go is ",(0,r.kt)("strong",{parentName:"li"},"not installed")," in your environment. You will run into issues if you attempt to set up your full node through Ansible with Go installed as Ansible requires specific packages of Go to be installed."),(0,r.kt)("li",{parentName:"ul"},"You will also need to make sure that your VM / Machine does not have any previous setups for Polygon Validator or Heimdall or Bor. You will need to delete them as your setup will run into issues.")),(0,r.kt)("admonition",{title:"Heimdall source enhancements",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The latest Heimdall version, ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/maticnetwork/heimdall/releases/tag/v0.3.3"},"v.0.3.3")),", contains a few enhancements.\nThe delay time between the contract events of different validators ",(0,r.kt)("strong",{parentName:"p"},"has been increased")," to ensure that the mempool doesn't get filled\nquickly in case of a burst of events that could hamper the chain's progress."),(0,r.kt)("p",{parentName:"admonition"},"Additionally, the data size ",(0,r.kt)("strong",{parentName:"p"},"has been restricted in state sync txs to 30Kb (when represented in bytes) and 60Kb (when defined as string)"),".\nFor example:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'Data - "abcd1234"\nLength in string format - 8\nHex Byte representation - [171 205 18 52]\nLength in byte format - 4\n'))),(0,r.kt)("h2",{id:"full-node-setup"},"Full node setup"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Ensure you have access to the remote machine or VM on which the full node is being set up."),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Refer to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/node-ansible#setup"},"https://github.com/maticnetwork/node-ansible#setup")," for more details."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Clone the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/node-ansible"},"https://github.com/maticnetwork/node-ansible")," repository.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Navigate into the node-ansible folder: ",(0,r.kt)("inlineCode",{parentName:"p"},"cd node-ansible"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Edit the ",(0,r.kt)("inlineCode",{parentName:"p"},"inventory.yml")," file and insert your IP(s) in the ",(0,r.kt)("inlineCode",{parentName:"p"},"sentry->hosts")," section."),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},"Refer to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/node-ansible#inventory"},"https://github.com/maticnetwork/node-ansible#inventory")," for more details."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check if the remote machine is reachable by running: ",(0,r.kt)("inlineCode",{parentName:"p"},"ansible sentry -m ping"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To test if the correct machine is configured, run the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# Mainnet:\nansible-playbook playbooks/network.yml --extra-var="bor_version=v0.3.9 heimdall_version=v0.3.3 network=mainnet node_type=sentry" --list-hosts\n\n# Testnet:\nansible-playbook playbooks/network.yml --extra-var="bor_version=v0.3.9 heimdall_version=v0.3.3 network=mumbai node_type=sentry" --list-hosts\n')),(0,r.kt)("img",{src:(0,l.Z)("img/network/full-node-mumbai.png")})),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Next, set up the full node with this command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# Mainnet:\nansible-playbook playbooks/network.yml --extra-var="bor_version=v0.3.9 heimdall_version=v0.3.3 network=mainnet node_type=sentry"\n\n# Testnet:\nansible-playbook playbooks/network.yml --extra-var="bor_version=v0.3.9 heimdall_version=v0.3.3 network=mumbai node_type=sentry"\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"In case you run into any issues, delete and clean the whole setup using:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"ansible-playbook playbooks/clean.yml\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Once you initiate the Ansible playbook, log in to the remote machine.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Please ",(0,r.kt)("strong",{parentName:"p"},"ensure that the value of seeds and bootnodes mentioned below is the same value as mentioned in Heimdall and Bor ",(0,r.kt)("inlineCode",{parentName:"strong"},"config.toml")," files"),". If not, change the values accordingly."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Heimdall seed nodes:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'moniker=<enter unique identifier>\n\n# Mainnet:\nseeds="2a53a15ffc70ad41b6876ecbe05c50a66af01e20@3.211.248.31:26656,6f829065789e5b156cbbf076f9d133b4d7725847@3.212.183.151:26656,7285a532bad665f051c0aadc31054e2e61ca2b3d@3.93.224.197:26656,0b431127d21c8970f1c353ab212be4f1ba86c3bf@184.73.124.158:26656,f4f605d60b8ffaaf15240564e58a81103510631c@159.203.9.164:26656,31b79cf4a628a4619e8e9ae95b72e4354c5a5d90@44.232.55.71:26656,a385dd467d11c4cdb0be8b51d7bfb0990f49abc3@35.199.4.13:26656,daad548c0a163faae1d8d58425f97207acf923fd@35.230.116.151:26656,81c76e82fcc3dc9a0a1554a3edaa09a632795ea8@35.221.13.28:26656"\n\n# Testnet:\nseeds="e72c0466a02ea43b2198bd3a9454b87a3ef0d77e@54.147.31.250:26656,b302d1ddb21102e794b524d05152a7834da05bd1@34.226.134.117:26656,9dfc12d9f39257cefc3d57a4d7302586e59a994e@18.213.200.99:26656"\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Bootnodes:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'# Mainnet:\nbootnode ["enode://0cb82b395094ee4a2915e9714894627de9ed8498fb881cec6db7c65e8b9a5bd7f2f25cc84e71e89d0947e51c76e85d0847de848c7782b13c0255247a6758178c@44.232.55.71:30303","enode://88116f4295f5a31538ae409e4d44ad40d22e44ee9342869e7d68bdec55b0f83c1530355ce8b41fbec0928a7d75a5745d528450d30aec92066ab6ba1ee351d710@159.203.9.164:30303","enode://4be7248c3a12c5f95d4ef5fff37f7c44ad1072fdb59701b2e5987c5f3846ef448ce7eabc941c5575b13db0fb016552c1fa5cca0dda1a8008cf6d63874c0f3eb7@3.93.224.197:30303","enode://32dd20eaf75513cf84ffc9940972ab17a62e88ea753b0780ea5eca9f40f9254064dacb99508337043d944c2a41b561a17deaad45c53ea0be02663e55e6a302b2@3.212.183.151:30303"]\n\n# Testnet:\nbootnodes ["enode://320553cda00dfc003f499a3ce9598029f364fbb3ed1222fdc20a94d97dcc4d8ba0cd0bfa996579dcc6d17a534741fb0a5da303a90579431259150de66b597251@54.147.31.250:30303","enode://f0f48a8781629f95ff02606081e6e43e4aebd503f3d07fc931fad7dd5ca1ba52bd849a6f6c3be0e375cf13c9ae04d859c4a9ae3546dc8ed4f10aa5dbb47d4998@34.226.134.117:30303"]\n'))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To check if Heimdall is synced"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"On the remote machine/VM, run ",(0,r.kt)("inlineCode",{parentName:"li"},"curl localhost:26657/status")),(0,r.kt)("li",{parentName:"ul"},"In the output, ",(0,r.kt)("inlineCode",{parentName:"li"},"catching_up")," value should be ",(0,r.kt)("inlineCode",{parentName:"li"},"false")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Once Heimdall is synced, run"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sudo service bor start"))))),(0,r.kt)("p",null,"You have successfully set up a full node with Ansible."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If Bor presents an error of permission to data, run this command to make the Bor user the owner of the Bor files:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo chown bor /var/lib/bor\n"))),(0,r.kt)("h2",{id:"logs"},"Logs"),(0,r.kt)("p",null,"Logs can be managed by the ",(0,r.kt)("inlineCode",{parentName:"p"},"journalctl")," linux tool. Here is a tutorial for advanced usage: ",(0,r.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs"},"How To Use Journalctl to View and Manipulate Systemd Logs"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check Heimdall node logs")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"journalctl -u heimdalld.service -f\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check Bor Rest-server logs")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"journalctl -u bor.service -f\n")),(0,r.kt)("h2",{id:"ports-and-firewall-setup"},"Ports and Firewall Setup"),(0,r.kt)("p",null,"Open ports 22, 26656 and 30303 to world (0.0.0.0/0) on sentry node firewall."),(0,r.kt)("p",null,"You can use VPN to restrict access for port 22 as per your requirement and security guidelines."))}f.isMDXComponent=!0}}]);