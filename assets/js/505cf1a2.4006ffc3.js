"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[53737],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),d=r,g=u["".concat(c,".").concat(d)]||u[d]||m[d]||o;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},75165:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return m}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],s={id:"network-agnostics",title:"Network Agnostic Transactions",sidebar_label:"Network Agnostic Transactions",description:"Integrate Network Agnostic Transactions in your dApp.",keywords:["docs","matic"],image:"https://matic.network/banners/matic-network-16x9.png"},c=void 0,l={unversionedId:"develop/meta-transactions/network-agnostics",id:"develop/meta-transactions/network-agnostics",title:"Network Agnostic Transactions",description:"Integrate Network Agnostic Transactions in your dApp.",source:"@site/docs/develop/meta-transactions/network-agnostics.md",sourceDirName:"develop/meta-transactions",slug:"/develop/meta-transactions/network-agnostics",permalink:"/matic-docs/docs/develop/meta-transactions/network-agnostics",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/develop/meta-transactions/network-agnostics.md",tags:[],version:"current",lastUpdatedBy:"Kennedy Batista",lastUpdatedAt:1686621530,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"network-agnostics",title:"Network Agnostic Transactions",sidebar_label:"Network Agnostic Transactions",description:"Integrate Network Agnostic Transactions in your dApp.",keywords:["docs","matic"],image:"https://matic.network/banners/matic-network-16x9.png"},sidebar:"develop",previous:{title:"Meta Transactions",permalink:"/matic-docs/docs/develop/meta-transactions/meta-transactions"},next:{title:"Bridges",permalink:"/matic-docs/docs/category/bridges"}},p={},m=[{value:"Goal",id:"goal",level:2},{value:"What is enabling transaction execution?",id:"what-is-enabling-transaction-execution",level:2},{value:"Integrate Network Agnostic Transactions in your dApp",id:"integrate-network-agnostic-transactions-in-your-dapp",level:2}],u={toc:m};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"goal"},"Goal"),(0,o.kt)("p",null,"Execute transactions on Polygon chain, without changing provider on MetaMask (this tutorial caters to metamask's inpage provider, can be modified to execute transactions from any other provider)"),(0,o.kt)("p",null,"Under the hood, user signs on an intent to execute a transaction, which is relayed by a simple relayer to execute it on a contract deployed on Polygon chain."),(0,o.kt)("h2",{id:"what-is-enabling-transaction-execution"},"What is enabling transaction execution?"),(0,o.kt)("p",null,"The client that the user interacts with (web browser, mobile apps, etc) never interacts with the blockchain, instead it interacts with a simple relayer server (or a network of relayers), similar to the way GSN or any meta-transaction solution works ( see: ",(0,o.kt)("a",{parentName:"p",href:"https://www.notion.so/Meta-Transactions-An-Introduction-8f54cf75321e4ec3b6d755e18e406590"},"Meta Transactions: An Introduction"),")."),(0,o.kt)("p",null,"For any action that requires blockchain interaction,"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Client requests an EIP712 formatted signature from the user"),(0,o.kt)("li",{parentName:"ul"},"The signature is sent to a simple relayer server (should have a simple auth/spam protection if used for production, or biconomy's mexa sdk can be used: ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/bcnmy/mexa-sdk"},"https://github.com/bcnmy/mexa-sdk"),")"),(0,o.kt)("li",{parentName:"ul"},"The relayer interacts with the blockchain to submit user's signature to the contract. A function on the contract called ",(0,o.kt)("inlineCode",{parentName:"li"},"executeMetaTransaction")," processes the signature and executes the requested transaction (via an internal call)."),(0,o.kt)("li",{parentName:"ul"},"The relayer pays for the gas making the transaction effectively free \ud83e\udd11")),(0,o.kt)("h2",{id:"integrate-network-agnostic-transactions-in-your-dapp"},"Integrate Network Agnostic Transactions in your dApp"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Choose between a custom simple relayer node/biconomy."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For biconomy, setup a dapp from the dashboard and save the api-id and api-key, see: ",(0,o.kt)("a",{parentName:"p",href:"https://www.notion.so/Tutorial-Biconomy-7f578bfb4e7d4904b8c79522085ba568"},"Tutorial: Biconomy")," or ",(0,o.kt)("a",{parentName:"p",href:"https://docs.biconomy.io/"},"https://docs.biconomy.io/")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Steps:")),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Let's Register our contracts to biconomy dashboard",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Visit the ",(0,o.kt)("a",{parentName:"li",href:"https://docs.biconomy.io/biconomy-dashboard"},"official documents of biconomy"),"."),(0,o.kt)("li",{parentName:"ol"},"While registering the dapp, select ",(0,o.kt)("inlineCode",{parentName:"li"},"Polygon Mumbai")))),(0,o.kt)("li",{parentName:"ol"},"Copy the",(0,o.kt)("inlineCode",{parentName:"li"},"API key")," to use in frontend"),(0,o.kt)("li",{parentName:"ol"},"And Add function ",(0,o.kt)("inlineCode",{parentName:"li"},"executeMetaTransaction")," in Manage-Api and make sure to enable meta-tx. (Check 'native-metatx' option)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If you'd like to use your own custom API that sends signed transactions on the blockchain, you can refer to the server code here: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/angelagilhotra/ETHOnline-Workshop/tree/master/2-network-agnostic-transfer"},"https://github.com/angelagilhotra/ETHOnline-Workshop/tree/master/2-network-agnostic-transfer"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Make sure that the contract you'd like to interact with inherits from ",(0,o.kt)("inlineCode",{parentName:"p"},"NativeMetaTransactions")," - \ud83d\udc40 peep into ",(0,o.kt)("inlineCode",{parentName:"p"},"executeMetaTransaction")," function in the contract.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Link: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/pos-portal/blob/34be03cfd227c25b49c5791ffba6a4ffc9b76036/flat/ChildERC20.sol#L1338"},"https://github.com/maticnetwork/pos-portal/blob/34be03cfd227c25b49c5791ffba6a4ffc9b76036/flat/ChildERC20.sol#L1338")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"\nlet data = await web3.eth.abi.encodeFunctionCall({\n    name: 'getNonce',\n    type: 'function',\n    inputs: [{\n        name: \"user\",\n        type: \"address\"\n      }]\n  }, [accounts[0]]);\n\n  let _nonce = await web3.eth.call ({\n    to: token[\"80001\"],\n    data\n  });\n\n  const dataToSign = getTypedData({\n    name: token[\"name\"],\n    version: '1',\n    salt: '0x0000000000000000000000000000000000000000000000000000000000013881',\n    verifyingContract: token[\"80001\"],\n    nonce: parseInt(_nonce),\n    from: accounts[0],\n    functionSignature: functionSig\n  });\n\n  const msgParams = [accounts[0], JSON.stringify(dataToSign)];\n\n  let sig = await eth.request ({\n    method: 'eth_signTypedData_v3',\n    params: msgParams\n  });\n\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Once you have a relayer and the contracts setup, what is required is for the client to be able to fetch an EIP712 formatted signature and simply call the API with the required parameters"),(0,o.kt)("p",{parentName:"li"},"  ref: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/angelagilhotra/ETHOnline-Workshop/blob/6b615b8a4ef00553c17729c721572529303c8e1b/2-network-agnostic-transfer/sign.js#L47"},"https://github.com/angelagilhotra/ETHOnline-Workshop/blob/6b615b8a4ef00553c17729c721572529303c8e1b/2-network-agnostic-transfer/sign.js#L47")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"\nlet data = await web3.eth.abi.encodeFunctionCall({\n    name: 'getNonce',\n    type: 'function',\n    inputs: [{\n        name: \"user\",\n        type: \"address\"\n      }]\n  }, [accounts[0]]);\n\n  let _nonce = await web3.eth.call ({\n    to: token[\"80001\"],\n    data\n  });\n\n  const dataToSign = getTypedData({\n    name: token[\"name\"],\n    version: '1',\n    salt: '0x0000000000000000000000000000000000000000000000000000000000013881',\n    verifyingContract: token[\"80001\"],\n    nonce: parseInt(_nonce),\n    from: accounts[0],\n    functionSignature: functionSig\n  });\n  const msgParams = [accounts[0], JSON.stringify(dataToSign)];\n\n  let sig = await eth.request ({\n    method: 'eth_signTypedData_v3',\n    params: msgParams\n  });\n")),(0,o.kt)("p",{parentName:"li"},"  Calling the API, ref: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/angelagilhotra/ETHOnline-Workshop/blob/6b615b8a4ef00553c17729c721572529303c8e1b/2-network-agnostic-transfer/sign.js#L110"},"https://github.com/angelagilhotra/ETHOnline-Workshop/blob/6b615b8a4ef00553c17729c721572529303c8e1b/2-network-agnostic-transfer/sign.js#L110")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const response = await request.post(\n    'http://localhost:3000/exec', {\n      json: txObj,\n    },\n    (error, res, body) => {\n      if (error) {\n        console.error(error)\n        return\n      }\n      document.getElementById(el).innerHTML =\n      `response:`+ JSON.stringify(body)\n    }\n  )\n")),(0,o.kt)("p",{parentName:"li"},"  If using Biconomy, the following should be called:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const response = await request.post(\n    'https://api.biconomy.io/api/v2/meta-tx/native', {\n      json: txObj,\n    },\n    (error, res, body) => {\n      if (error) {\n        console.error(error)\n        return\n      }\n      document.getElementById(el).innerHTML =\n      `response:`+ JSON.stringify(body)\n    }\n  )\n")),(0,o.kt)("p",{parentName:"li"},"  where the ",(0,o.kt)("inlineCode",{parentName:"p"},"txObj")," should look something like:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "to": "0x2395d740789d8C27C139C62d1aF786c77c9a1Ef1",\n    "apiId": <API ID COPIED FROM THE API PAGE>,\n    "params": [\n        "0x2173fdd5427c99357ba0dd5e34c964b08079a695",\n        "0x2e1a7d4d000000000000000000000000000000000000000000000000000000000000000a",\n        "0x42da8b5ac3f1c5c35c3eb38d639a780ec973744f11ff75b81bbf916300411602",\n        "0x32bf1451a3e999b57822bc1a9b8bfdfeb0da59aa330c247e4befafa997a11de9",\n        "27"\n    ],\n    "from": "0x2173fdd5427c99357ba0dd5e34c964b08079a695"\n}\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If you use the custom API it executes the ",(0,o.kt)("inlineCode",{parentName:"p"},"executeMetaTransaction")," function on the contract:"),(0,o.kt)("p",{parentName:"li"},"  (ref: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/angelagilhotra/ETHOnline-Workshop/blob/6b615b8a4ef00553c17729c721572529303c8e1b/2-network-agnostic-transfer/server/index.js#L40"},"https://github.com/angelagilhotra/ETHOnline-Workshop/blob/6b615b8a4ef00553c17729c721572529303c8e1b/2-network-agnostic-transfer/server/index.js#L40"),")"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"try {\n    let tx = await contract.methods.executeMetaTransaction(\n      txDetails.from, txDetails.fnSig, r, s, v\n    ).send ({\n      from: user,\n      gas: 800000\n    })\n    req.txHash = tx.transactionHash\n  } catch (err) {\n    console.log (err)\n    next(err)\n  }\n")),(0,o.kt)("p",{parentName:"li"},"  is using biconomy, the client side call looks like:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'// client/src/App.js\nimport React from "react";\nimport Biconomy from "@biconomy/mexa";\n\nconst getWeb3 = new Web3(biconomy);\nbiconomy\n    .onEvent(biconomy.READY, () => {\n      // Initialize your dapp here like getting user accounts etc\n      console.log("Mexa is Ready");\n    })\n    .onEvent(biconomy.ERROR, (error, message) => {\n      // Handle error while initializing mexa\n            console.error(error);\n    });\n\n/**\n* use the getWeb3 object to define a contract and calling the function directly\n*/\n\n')))))}d.isMDXComponent=!0}}]);