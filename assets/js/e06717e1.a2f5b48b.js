"use strict";(self.webpackChunkmatic_docs=self.webpackChunkmatic_docs||[]).push([[74657],{3905:function(e,t,i){i.d(t,{Zo:function(){return c},kt:function(){return m}});var a=i(67294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t){if(null==e)return{};var i,a,n=function(e,t){if(null==e)return{};var i,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)i=r[a],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var s=a.createContext({}),p=function(e){var t=a.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):l(l({},t),e)),i},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var i=e.components,n=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(i),m=n,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||r;return i?a.createElement(h,l(l({ref:t},c),{},{components:i})):a.createElement(h,l({ref:t},c))}));function m(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=i.length,l=new Array(r);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var p=2;p<r;p++)l[p]=i[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,i)}u.displayName="MDXCreateElement"},55042:function(e,t,i){i.r(t),i.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return o},metadata:function(){return p},toc:function(){return d}});var a=i(87462),n=i(63366),r=(i(67294),i(3905)),l=["components"],o={id:"optimisticoracle",title:"UMA's Optimistic Oracle",sidebar_label:"UMA",description:"UMA's Optimistic Oracle allows contracts to quickly request and receive any kind of data",keywords:["wiki","polygon","oracle","UMA","Optimistic Oracle"],image:"https://wiki.polygon.technology/img/polygon-logo.png"},s=void 0,p={unversionedId:"develop/oracles/optimisticoracle",id:"develop/oracles/optimisticoracle",title:"UMA's Optimistic Oracle",description:"UMA's Optimistic Oracle allows contracts to quickly request and receive any kind of data",source:"@site/docs/develop/oracles/optimisticoracle.md",sourceDirName:"develop/oracles",slug:"/develop/oracles/optimisticoracle",permalink:"/matic-docs/docs/develop/oracles/optimisticoracle",draft:!1,editUrl:"https://github.com/maticnetwork/matic-docs/tree/master/docs/develop/oracles/optimisticoracle.md",tags:[],version:"current",lastUpdatedBy:"k-batista",lastUpdatedAt:1686626387,formattedLastUpdatedAt:"Jun 13, 2023",frontMatter:{id:"optimisticoracle",title:"UMA's Optimistic Oracle",sidebar_label:"UMA",description:"UMA's Optimistic Oracle allows contracts to quickly request and receive any kind of data",keywords:["wiki","polygon","oracle","UMA","Optimistic Oracle"],image:"https://wiki.polygon.technology/img/polygon-logo.png"},sidebar:"develop",previous:{title:"Chainlink",permalink:"/matic-docs/docs/develop/oracles/chainlink"},next:{title:"Razor",permalink:"/matic-docs/docs/develop/oracles/razor"}},c={},d=[{value:"Optimistic Oracle",id:"optimistic-oracle",level:2},{value:"Data Verification Mechanism (DVM)",id:"data-verification-mechanism-dvm",level:2},{value:"Optimistic Oracle Interface",id:"optimistic-oracle-interface",level:2},{value:"requestPrice",id:"requestprice",level:3},{value:"proposePrice",id:"proposeprice",level:3},{value:"disputePrice",id:"disputeprice",level:3},{value:"settle",id:"settle",level:3},{value:"hasPrice",id:"hasprice",level:3},{value:"getRequest",id:"getrequest",level:3},{value:"settleAndGetPrice",id:"settleandgetprice",level:3},{value:"setBond",id:"setbond",level:3},{value:"setCustomLiveness",id:"setcustomliveness",level:3},{value:"setRefundOnDispute",id:"setrefundondispute",level:3},{value:"disputePriceFor",id:"disputepricefor",level:3},{value:"proposePriceFor",id:"proposepricefor",level:3},{value:"Integrating the Optimistic Oracle",id:"integrating-the-optimistic-oracle",level:2},{value:"Running the Demo",id:"running-the-demo",level:2},{value:"Explaining the Contract Functions",id:"explaining-the-contract-functions",level:2},{value:"Additional Resources",id:"additional-resources",level:2}],u={toc:d};function m(e){var t=e.components,i=(0,n.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"Content disclaimer",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Please view the third-party content disclaimer ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maticnetwork/matic-docs/blob/master/CONTENT_DISCLAIMER.md"},(0,r.kt)("ins",null,"here")),".")),(0,r.kt)("hr",null),(0,r.kt)("p",null,"UMA's Optimistic Oracle allows contracts to quickly request and receive any kind of data. UMA's oracle system is comprised of two core components:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Optimistic Oracle"),(0,r.kt)("li",{parentName:"ol"},"Data Verification Mechanism (DVM)")),(0,r.kt)("h2",{id:"optimistic-oracle"},"Optimistic Oracle"),(0,r.kt)("p",null,"UMA's ",(0,r.kt)("strong",{parentName:"p"},"Optimistic Oracle")," allows contracts to quickly request and receive price information. The Optimistic Oracle acts as a generalized escalation game between contracts that initiate a price request and UMA's dispute resolution system known as the Data Verification Mechanism (DVM)."),(0,r.kt)("p",null,"Prices proposed by the Optimistic Oracle will not be sent to the DVM unless it is disputed. This enables contracts to obtain price information within any pre-defined length of time without writing the price of an asset on-chain."),(0,r.kt)("h2",{id:"data-verification-mechanism-dvm"},"Data Verification Mechanism (DVM)"),(0,r.kt)("p",null,"If a dispute is raised, a request is sent to the DVM. All contracts built on UMA use the DVM as a backstop to resolve disputes. Disputes sent to the DVM will be resolved 48 hours after UMA tokenholders vote on the price of the asset at a given time. Contracts on UMA do not need to use the Optimistic Oracle unless it requires a price of an asset faster than 48 hours."),(0,r.kt)("p",null,"The Data Verification Mechanism (DVM) is the dispute resolution service for contracts built on UMA Protocol. The DVM is powerful because it encompasses an element of human judgment to ensure contracts are securely and correctly managed when issues arise from volatile (and sometimes manipulatable) markets."),(0,r.kt)("h2",{id:"optimistic-oracle-interface"},"Optimistic Oracle Interface"),(0,r.kt)("p",null,"The Optimistic Oracle is used by financial contracts or any third party to retrieve prices. Once a price is requested, anyone can propose a price in response. Once proposed, the price goes through a liveness period where anyone can dispute the proposed price and send the disputed price to the UMA DVM for settlement."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"This section explains how different participants can interact with the Optimistic Oracle. To view the most updated mainnet, kovan or L2 deployments of the Optimistic Oracle contracts, refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.umaproject.org/dev-ref/addresses"},"production addresses"),".")),(0,r.kt)("p",null,"There are twelve methods that make up the Optimistic Oracle interface."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requestPrice")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"proposePrice")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"disputePrice")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"settle")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"hasPrice")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"getRequest")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"settleAndGetPrice")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setBond")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setCustomLiveness")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setRefundOnDispute")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"proposePriceFor")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"disputePriceFor"))),(0,r.kt)("h3",{id:"requestprice"},"requestPrice"),(0,r.kt)("p",null,"Requests a new price. This must be for a registered price identifier. Note that this is called automatically by most financial contracts that are registered in the UMA system, but can be called by anyone for any registered price identifier. For example, the Expiring Multiparty (EMP) contract calls this method when its ",(0,r.kt)("inlineCode",{parentName:"p"},"expire")," method is called."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier being requested."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp of the price being requested."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data representing additional args being passed with the price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"currency"),": ERC20 token used for payment of rewards and fees. Must be approved for use with the DVM."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"reward"),": reward offered to a successful proposer. Will be paid by the caller. Note: this can be 0.")),(0,r.kt)("h3",{id:"proposeprice"},"proposePrice"),(0,r.kt)("p",null,"Proposes a price value for an existing price request."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"proposedPrice"),": price being proposed.")),(0,r.kt)("h3",{id:"disputeprice"},"disputePrice"),(0,r.kt)("p",null,"Disputes a price value for an existing price request with an active proposal."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"settle"},"settle"),(0,r.kt)("p",null,"Attempts to settle an outstanding price request. Will revert if it can\u2019t be settled."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"hasprice"},"hasPrice"),(0,r.kt)("p",null,"Checks if a given request has resolved or been settled (i.e the optimistic oracle has a price)."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"getrequest"},"getRequest"),(0,r.kt)("p",null,"Gets the current data structure containing all information about a price request."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"settleandgetprice"},"settleAndGetPrice"),(0,r.kt)("p",null,"Retrieves a price that was previously requested by a caller. Reverts if the request is not settled or settleable. Note: this method is not view so that this call may actually settle the price request if it hasn\u2019t been settled."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"setbond"},"setBond"),(0,r.kt)("p",null,"Set the proposal bond associated with a price request."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"bond"),": custom bond amount to set.")),(0,r.kt)("h3",{id:"setcustomliveness"},"setCustomLiveness"),(0,r.kt)("p",null,"Sets a custom liveness value for the request. Liveness is the amount of time a proposal must wait before being auto-resolved."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"customLiveness"),": new custom liveness.")),(0,r.kt)("h3",{id:"setrefundondispute"},"setRefundOnDispute"),(0,r.kt)("p",null,'Sets the request to refund the reward if the proposal is disputed. This can help to "hedge" the caller in the event of a dispute-caused delay. Note: in the event of a dispute, the winner still receives the other\u2019s bond, so there is still profit to be made even if the reward is refunded.'),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"disputepricefor"},"disputePriceFor"),(0,r.kt)("p",null,"Disputes a price request with an active proposal on another address' behalf. Note: this address will receive any rewards that come from this dispute. However, any bonds are pulled from the caller."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"disputer"),": address to set as the disputer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested.")),(0,r.kt)("h3",{id:"proposepricefor"},"proposePriceFor"),(0,r.kt)("p",null,"Proposes a price value on another address' behalf. Note: this address will receive any rewards that come from this proposal. However, any bonds are pulled from the caller."),(0,r.kt)("p",null,"Parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"proposer"),": address to set as the proposer."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"requester"),": sender of the initial price request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"identifier"),": price identifier to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),": timestamp to identify the existing request."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ancillaryData"),": ancillary data of the price being requested."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"proposedPrice"),": price being proposed.")),(0,r.kt)("h2",{id:"integrating-the-optimistic-oracle"},"Integrating the Optimistic Oracle"),(0,r.kt)("p",null,"This demo will set up an ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticDepositBox")," contract which custodies a user\u2019s ERC-20 token balance."),(0,r.kt)("p",null,"On a local testnet blockchain, the user will deposit wETH (Wrapped Ether) into the contract and withdraw wETH denominated in USD. For example, if the user wants to withdraw $10,000 USD of wETH, and the ETH/USD exchange rate is $2,000, they would withdraw 5 wETH."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The user links the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticDepositBox")," with one of the price identifiers enabled on the DVM.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The user deposits wETH into the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticDepositBox")," and register it with the ",(0,r.kt)("inlineCode",{parentName:"p"},"ETH/USD")," price identifier.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"The user can now withdraw a USD-denominated amount of wETH from their ",(0,r.kt)("inlineCode",{parentName:"p"},"DepositBox")," via smart contract calls, with the Optimistic Oracle enabling optimistic on-chain pricing."))),(0,r.kt)("p",null,"In this example, the user would not have been able to transfer USD-denominated amounts of wETH without referencing an off-chain ",(0,r.kt)("inlineCode",{parentName:"p"},"ETH/USD"),' price feed. The Optimistic Oracle therefore enables the user to "pull" a reference price.'),(0,r.kt)("p",null,"Unlike price requests to the DVM, a price request to the Optimistic Oracle can be resolved within a specified liveness window if there are no disputes, which can be significantly shorter than the DVM voting period. The liveness window is configurable, but is typically two hours, compared to 2-3 days for settlement via the DVM."),(0,r.kt)("p",null,"The price requestor is not currently required to pay fees to the DVM. The requestor can offer a reward for the proposer who responds to a price request, but the reward value is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," in this example."),(0,r.kt)("p",null,"The price proposer posts a bond along with their price, which will be refunded if the price is not disputed, or if a dispute is resolved in the proposer's favor. Otherwise, this bond is used to pay the final fee to the DVM and pay a reward to a successful disputer."),(0,r.kt)("p",null,"In the demo, the requestor does not require an additional bond from the price proposer, so the total bond posted is equal to the wETH final fee currently 0.2 wETH. See the ",(0,r.kt)("inlineCode",{parentName:"p"},"proposePriceFor")," function in the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticOracle")," ",(0,r.kt)("a",{parentName:"p",href:"https://docs-dot-uma-protocol.appspot.com/uma/contracts/OptimisticOracle.html"},"contract")," for implementation details."),(0,r.kt)("h2",{id:"running-the-demo"},"Running the Demo"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ensure that you have followed all the prerequisite setup steps ",(0,r.kt)("a",{parentName:"p",href:"https://docs.umaproject.org/developers/setup"},"here"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run a local Ganache instance (i.e. not Kovan/Ropsten/Rinkeby/Mainnet) with ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn ganache-cli --port 9545"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In another window, migrate the contracts by running the following command:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yarn truffle migrate --reset --network test\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"To deploy the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticDepositBox")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/UMAprotocol/dev-quickstart/blob/main/contracts/OptimisticDepositBox.sol"},"contract")," and go through a simple user flow, run the following demo script from the root of the repo:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yarn truffle exec ./packages/core/scripts/demo/OptimisticDepositBox.js --network test\n")),(0,r.kt)("p",null,"You should see the following output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"1. Deploying new OptimisticDepositBox\n  - Using wETH as collateral token\n  - Pricefeed identifier for ETH/USD is whitelisted\n  - Collateral address for wETH is whitelisted\n  - Deployed an OptimisticOracle\n  - Deployed a new OptimisticDepositBox\n\n\n2. Minting ERC20 to user and giving OptimisticDepositBox allowance to transfer collateral\n  - Converted 10 ETH into wETH\n  - User's wETH balance: 10\n  - Increased OptimisticDepositBox allowance to spend wETH\n  - Contract's wETH allowance: 10\n\n\n3. Depositing ERC20 into the OptimisticDepositBox\n  - Deposited 10 wETH into the OptimisticDepositBox\n  - User's deposit balance: 10\n  - Total deposit balance: 10\n  - User's wETH balance: 0\n\n\n4. Withdrawing ERC20 from OptimisticDepositBox\n  - Submitted a withdrawal request for 10000 USD of wETH\n  - Proposed a price of 2000000000000000000000 ETH/USD\n  - Fast-forwarded the Optimistic Oracle and Optimistic Deposit Box to after the liveness window so we can settle.\n  - New OO time is [fast-forwarded timestamp]\n  - New ODB time is [fast-forwarded timestamp]\n  - Executed withdrawal. This also settles and gets the resolved price within the withdrawal function.\n  - User's deposit balance: 5\n  - Total deposit balance: 5\n  - User's wETH balance: 5\n")),(0,r.kt)("h2",{id:"explaining-the-contract-functions"},"Explaining the Contract Functions"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticDepositBox")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/UMAprotocol/dev-quickstart/blob/main/contracts/OptimisticDepositBox.sol"},"contract code")," shows how to interact with the Oracle."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"constructor")," function includes a ",(0,r.kt)("inlineCode",{parentName:"p"},"_finderAddress")," argument for the UMA ",(0,r.kt)("inlineCode",{parentName:"p"},"Finder")," contract, which maintains a registry of the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticOracle")," address, approved collateral and price identifier whitelists, and other important contract addresses."),(0,r.kt)("p",null,"This allows the ",(0,r.kt)("inlineCode",{parentName:"p"},"constructor")," to check that the collateral type and price identifier are valid, and allows the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticDepositBox")," to find and interact with the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticOracle")," later."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"requestWithdrawal")," function includes an internal call to the ",(0,r.kt)("inlineCode",{parentName:"p"},"OptimisticOracle")," requesting the ",(0,r.kt)("inlineCode",{parentName:"p"},"ETH/USD")," price. Once it's returned, the user can call ",(0,r.kt)("inlineCode",{parentName:"p"},"executeWithdrawal")," to complete the withdrawal."),(0,r.kt)("p",null,"There is much more information and explanation in the code comments, so please take a look if you're interested in learning more."),(0,r.kt)("h2",{id:"additional-resources"},"Additional Resources"),(0,r.kt)("p",null,"Here are some additional resources regarding the UMA DVM:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.umaproject.org/oracle/tech-architecture"},"Technical Architecture")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.umaproject.org/oracle/econ-architecture"},"Economic Architecture")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://medium.com/uma-project/umas-data-verification-mechanism-3c5342759eb8"},"Blog post")," on UMA\u2019s DVM design"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/UMAprotocol/whitepaper/blob/master/UMA-DVM-oracle-whitepaper.pdf"},"Whitepaper")," on UMA\u2019s DVM design"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/UMAprotocol/research"},"Research repo")," for optimal fee policy"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/UMAprotocol/UMIPs"},"UMIP repo")," for governance proposals")))}m.isMDXComponent=!0}}]);